
<html>
<head>
  <meta charset="utf-8" />
</head>
<body>
  <script src="../utils/swipe-controls/swipe-controls.js"></script>  
  <script>
    var odyc=(function(exports){'use strict';var r0=class{#x;#t;#i;position=[0,0];#e;#r;constructor(x){this.#e=x.screenWidth,this.#r=x.screenHeight,x.cameraWidth&&x.cameraHeight&&(this.#t=x.cameraWidth,this.#i=x.cameraHeight,this.#x={left:(x.screenWidth-this.#t)*.5,right:(x.screenWidth+this.#t)*.5-1,top:(x.screenHeight-this.#i)*.5,bottom:(x.screenHeight+this.#i)*.5-1});}update(x,e){let[t,r]=x;if(!this.#x||!this.#e||!this.#r){this.position[0]=Math.floor(t/this.#e)*this.#e,this.position[1]=Math.floor(r/this.#r)*this.#r,this.#s(e);return}let[s,n]=this.position,a=t-s,o=r-n;a<this.#x.left&&(this.position[0]-=this.#x.left-a),a>this.#x.right&&(this.position[0]+=a-this.#x.right),o<this.#x.top&&(this.position[1]-=this.#x.top-o),o>this.#x.bottom&&(this.position[1]+=o-this.#x.bottom),this.#s(e);}isOnScreen(x){let[e,t]=x,r=e-this.position[0],s=t-this.position[1];return r>=0&&s>=0&&r<this.#e&&s<this.#r}reset(){this.position=[0,0];}#s(x){let[e,t]=x;this.position[0]=Math.max(0,Math.min(this.position[0],e-this.#e)),this.position[1]=Math.max(0,Math.min(this.position[1],t-this.#r));}},I0=i=>new r0(i);var G="odyc-dialog-canvas";var w0={SLOW:60,NORMAL:30,FAST:15},M="odyc-filter-canvas",R0=200,s0=60,D=200,n0=60,o0=30,k="odyc-message-canvas",U="odyc-prompt-canvas",C=384,m=2,a0=28,W=10,S=8,H=12,O=8,L=2,V="odyc-renderer-canvas",B="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");var v=i=>i.trim().replace(/[ \t]/gm,"").split(/\n+/gm),X=i=>{let x=i.length;return [Math.max(...i.map(t=>t.length)),x]};var c0=i=>{try{return new URL(i),!0}catch{return  false}},p=(i,x)=>{if(i=`${i}`,i.length>1)return i;let e=B.findIndex(r=>r===i);return e===-1||e>=x.length?"transparent":x[e]??"transparent"};var M0=(i,x)=>{let e;return (...t)=>{let r;return e&&clearTimeout(e),e=setTimeout(()=>{r=i(...t);},x),r}};function y(){let i=0,x=new Map;return {subscribe(e){let t=i++;return x.set(t,e),()=>x.delete(t)},notify(e){x.forEach(t=>t(e));},clear(){x.clear();}}}var sx=[[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[24,60,60,24,24,0,24,0],[54,54,0,0,0,0,0,0],[54,54,127,54,127,54,54,0],[12,62,3,30,48,31,12,0],[0,99,51,24,12,102,99,0],[28,54,28,110,59,51,110,0],[6,6,3,0,0,0,0,0],[24,12,6,6,6,12,24,0],[6,12,24,24,24,12,6,0],[0,102,60,255,60,102,0,0],[0,12,12,63,12,12,0,0],[0,0,0,0,0,12,12,6],[0,0,0,63,0,0,0,0],[0,0,0,0,0,12,12,0],[96,48,24,12,6,3,1,0],[62,99,115,123,111,103,62,0],[12,14,12,12,12,12,63,0],[30,51,48,28,6,51,63,0],[30,51,48,28,48,51,30,0],[56,60,54,51,127,48,120,0],[63,3,31,48,48,51,30,0],[28,6,3,31,51,51,30,0],[63,51,48,24,12,12,12,0],[30,51,51,30,51,51,30,0],[30,51,51,62,48,24,14,0],[0,12,12,0,0,12,12,0],[0,12,12,0,0,12,12,6],[24,12,6,3,6,12,24,0],[0,0,63,0,0,63,0,0],[6,12,24,48,24,12,6,0],[30,51,48,24,12,0,12,0],[62,99,123,123,123,3,30,0],[12,30,51,51,63,51,51,0],[63,102,102,62,102,102,63,0],[60,102,3,3,3,102,60,0],[31,54,102,102,102,54,31,0],[127,70,22,30,22,70,127,0],[127,70,22,30,22,6,15,0],[60,102,3,3,115,102,124,0],[51,51,51,63,51,51,51,0],[30,12,12,12,12,12,30,0],[120,48,48,48,51,51,30,0],[103,102,54,30,54,102,103,0],[15,6,6,6,70,102,127,0],[99,119,127,127,107,99,99,0],[99,103,111,123,115,99,99,0],[28,54,99,99,99,54,28,0],[63,102,102,62,6,6,15,0],[30,51,51,51,59,30,56,0],[63,102,102,62,54,102,103,0],[30,51,7,14,56,51,30,0],[63,45,12,12,12,12,30,0],[51,51,51,51,51,51,63,0],[51,51,51,51,51,30,12,0],[99,99,99,107,127,119,99,0],[99,99,54,28,28,54,99,0],[51,51,51,30,12,12,30,0],[127,99,49,24,76,102,127,0],[30,6,6,6,6,6,30,0],[3,6,12,24,48,96,64,0],[30,24,24,24,24,24,30,0],[8,28,54,99,0,0,0,0],[0,0,0,0,0,0,0,255],[12,12,24,0,0,0,0,0],[0,0,30,48,62,51,110,0],[7,6,6,62,102,102,59,0],[0,0,30,51,3,51,30,0],[56,48,48,62,51,51,110,0],[0,0,30,51,63,3,30,0],[28,54,6,15,6,6,15,0],[0,0,110,51,51,62,48,31],[7,6,54,110,102,102,103,0],[12,0,14,12,12,12,30,0],[48,0,48,48,48,51,51,30],[7,6,102,54,30,54,103,0],[14,12,12,12,12,12,30,0],[0,0,51,127,127,107,99,0],[0,0,31,51,51,51,51,0],[0,0,30,51,51,51,30,0],[0,0,59,102,102,62,6,15],[0,0,110,51,51,62,48,120],[0,0,59,110,102,6,15,0],[0,0,62,3,30,48,31,0],[8,12,62,12,12,44,24,0],[0,0,51,51,51,51,110,0],[0,0,51,51,51,30,12,0],[0,0,99,107,127,127,54,0],[0,0,99,54,28,54,99,0],[0,0,51,51,51,62,48,31],[0,0,63,25,12,38,63,0],[56,12,12,7,12,12,56,0],[24,24,24,0,24,24,24,0],[7,12,12,56,12,12,7,0],[110,59,0,0,0,0,0,0],[0,0,0,0,0,0,0,0]],nx=[[0,0,0,0,0,0,0,0],[24,24,0,24,24,24,24,0],[24,24,126,3,3,126,24,24],[28,54,38,15,6,103,63,0],[0,0,99,62,54,62,99,0],[51,51,30,63,12,63,12,12],[24,24,24,0,24,24,24,0],[124,198,28,54,54,28,51,30],[51,0,0,0,0,0,0,0],[60,66,153,133,133,153,66,60],[60,54,54,124,0,0,0,0],[0,204,102,51,102,204,0,0],[0,0,0,63,48,48,0,0],[0,0,0,0,0,0,0,0],[60,66,157,165,157,165,66,60],[126,0,0,0,0,0,0,0],[28,54,54,28,0,0,0,0],[24,24,126,24,24,0,126,0],[28,48,24,12,60,0,0,0],[28,48,24,48,28,0,0,0],[24,12,0,0,0,0,0,0],[0,0,102,102,102,62,6,3],[254,219,219,222,216,216,216,0],[0,0,0,24,24,0,0,0],[0,0,0,0,0,24,48,30],[8,12,8,28,0,0,0,0],[28,54,54,28,0,0,0,0],[0,51,102,204,102,51,0,0],[195,99,51,189,236,246,243,3],[195,99,51,123,204,102,51,240],[3,196,99,180,219,172,230,128],[12,0,12,6,3,51,30,0],[7,0,28,54,99,127,99,0],[112,0,28,54,99,127,99,0],[28,54,0,62,99,127,99,0],[110,59,0,62,99,127,99,0],[99,28,54,99,127,99,99,0],[12,12,0,30,51,63,51,0],[124,54,51,127,51,51,115,0],[30,51,3,51,30,24,48,30],[7,0,63,6,30,6,63,0],[56,0,63,6,30,6,63,0],[12,18,63,6,30,6,63,0],[54,0,63,6,30,6,63,0],[7,0,30,12,12,12,30,0],[56,0,30,12,12,12,30,0],[12,18,0,30,12,12,30,0],[51,0,30,12,12,12,30,0],[63,102,111,111,102,102,63,0],[63,0,51,55,63,59,51,0],[14,0,24,60,102,60,24,0],[112,0,24,60,102,60,24,0],[60,102,24,60,102,60,24,0],[110,59,0,62,99,99,62,0],[195,24,60,102,102,60,24,0],[0,54,28,8,28,54,0,0],[92,54,115,123,111,54,29,0],[14,0,102,102,102,102,60,0],[112,0,102,102,102,102,60,0],[60,102,0,102,102,102,60,0],[51,0,51,51,51,51,30,0],[112,0,102,102,60,24,24,0],[15,6,62,102,102,62,6,15],[0,30,51,31,51,31,3,3],[7,0,30,48,62,51,126,0],[56,0,30,48,62,51,126,0],[126,195,60,96,124,102,252,0],[110,59,30,48,62,51,126,0],[51,0,30,48,62,51,126,0],[12,12,30,48,62,51,126,0],[0,0,254,48,254,51,254,0],[0,0,30,3,3,30,48,28],[7,0,30,51,63,3,30,0],[56,0,30,51,63,3,30,0],[126,195,60,102,126,6,60,0],[51,0,30,51,63,3,30,0],[7,0,14,12,12,12,30,0],[28,0,14,12,12,12,30,0],[62,99,28,24,24,24,60,0],[51,0,14,12,12,12,30,0],[27,14,27,48,62,51,30,0],[0,31,0,31,51,51,51,0],[0,7,0,30,51,51,30,0],[0,56,0,30,51,51,30,0],[30,51,0,30,51,51,30,0],[110,59,0,30,51,51,30,0],[0,51,0,30,51,51,30,0],[24,24,0,126,0,24,24,0],[0,96,60,118,126,110,60,6],[0,7,0,51,51,51,126,0],[0,56,0,51,51,51,126,0],[30,51,0,51,51,51,126,0],[0,51,0,51,51,51,126,0],[0,56,0,51,51,62,48,31],[0,0,6,62,102,62,6,0],[0,51,0,51,51,62,48,31]],ox=[[0,4,6,255,255,6,4,0],[24,60,126,24,24,24,24,24],[0,32,96,255,255,96,32,0],[24,24,24,24,24,126,60,24]],ax=[[45,0,12,12,12,44,24,0],[12,30,51,51,63,51,51,0],[63,102,102,62,102,102,63,0],[63,51,3,3,3,3,3,0],[8,28,28,54,54,99,127,0],[127,70,22,30,22,70,127,0],[127,99,49,24,76,102,127,0],[51,51,51,63,51,51,51,0],[28,54,99,127,99,54,28,0],[30,12,12,12,12,12,30,0],[103,102,54,30,54,102,103,0],[8,28,28,54,54,99,99,0],[99,119,127,127,107,99,99,0],[99,103,111,123,115,99,99,0],[127,99,0,62,0,99,127,0],[28,54,99,99,99,54,28,0],[127,54,54,54,54,54,54,0],[63,102,102,62,6,6,15,0],[0,1,2,4,79,144,160,64],[127,99,6,12,6,99,127,0],[63,45,12,12,12,12,30,0],[51,51,51,30,12,12,30,0],[24,126,219,219,219,126,24,0],[99,99,54,28,54,99,99,0],[219,219,219,126,24,24,60,0],[62,99,99,99,54,54,119,0],[51,0,30,12,12,12,30,0],[51,0,51,51,30,12,30,0],[112,0,110,59,19,59,110,0],[56,0,30,3,14,3,30,0],[56,0,31,51,51,51,51,48],[56,0,12,12,12,44,24,0],[45,0,51,51,51,51,30,0],[0,0,110,59,19,59,110,0],[0,30,51,31,51,31,3,3],[0,0,51,51,30,12,12,0],[56,12,24,62,51,51,30,0],[0,0,30,3,14,3,30,0],[0,63,6,3,3,30,48,28],[0,0,31,51,51,51,51,48],[0,0,30,51,63,51,30,0],[0,0,12,12,12,44,24,0],[0,0,51,27,15,27,51,0],[0,3,6,12,28,54,99,0],[0,0,102,102,102,62,6,3],[0,0,51,51,51,30,12,0],[30,3,14,3,3,30,48,28],[0,0,30,51,51,51,30,0],[0,0,127,54,54,54,54,0],[0,0,60,102,102,54,6,6],[0,0,62,3,3,30,48,28],[0,0,126,27,27,27,14,0],[0,0,126,24,24,88,48,0],[0,0,51,51,51,51,30,0],[0,0,118,219,219,126,24,0],[0,99,54,28,28,54,99,0],[0,0,219,219,219,126,24,0],[0,0,54,99,107,127,54,0]],cx=[[0,0,0,0,0,0,0,0],[4,63,4,60,86,77,38,0],[4,63,4,60,86,77,38,0],[0,0,0,17,33,37,2,0],[0,1,17,33,33,37,2,0],[0,28,0,28,34,32,24,0],[60,0,60,66,64,32,24,0],[28,0,62,16,56,36,98,0],[28,0,62,16,56,36,98,0],[36,79,4,60,70,69,34,0],[36,79,4,60,70,69,34,0],[4,36,79,84,82,18,9,0],[68,36,15,84,82,82,9,0],[8,31,8,63,28,2,60,0],[68,47,4,31,14,1,30,0],[16,8,4,2,4,8,16,0],[40,68,18,33,2,4,8,0],[0,34,121,33,33,34,16,0],[64,34,17,61,17,18,8,0],[0,0,60,0,2,2,60,0],[32,64,22,32,1,1,14,0],[16,126,16,60,2,2,28,0],[36,79,20,46,1,1,14,0],[0,2,2,2,66,34,28,0],[32,66,18,34,2,34,28,0],[16,126,24,20,24,16,12,0],[68,47,6,5,6,4,3,0],[32,114,47,34,26,2,28,0],[128,80,58,23,26,2,28,0],[30,8,4,127,8,4,56,0],[79,36,2,127,8,4,56,0],[2,15,2,114,2,9,113,0],[66,47,2,114,2,9,113,0],[8,126,8,60,64,64,56,0],[68,47,4,30,32,32,28,0],[0,0,0,28,34,32,28,0],[0,28,34,65,64,32,28,0],[64,32,30,33,32,32,28,0],[0,62,8,4,4,4,56,0],[0,62,72,36,4,4,56,0],[4,4,8,60,2,2,60,0],[68,36,8,60,2,2,60,0],[50,2,39,34,114,41,17,0],[0,2,122,2,10,114,2,0],[8,9,62,75,101,85,34,0],[4,7,52,76,102,84,36,0],[0,0,60,74,73,69,34,0],[0,34,122,34,114,42,18,0],[128,81,29,17,57,21,9,0],[64,177,93,17,57,21,9,0],[0,0,19,50,81,17,14,0],[64,32,3,50,81,17,14,0],[64,160,67,50,81,17,14,0],[28,0,8,42,73,16,12,0],[76,32,8,42,73,16,12,0],[76,160,72,10,41,72,12,0],[0,0,4,10,17,32,64,0],[32,64,20,42,17,32,64,0],[32,80,36,10,17,32,64,0],[125,17,125,17,57,85,9,0],[157,81,29,17,57,85,9,0],[93,177,93,17,57,85,9,0],[126,8,62,8,28,42,4,0],[0,7,36,36,126,37,18,0],[4,15,100,6,5,38,60,0],[0,9,61,74,75,69,42,0],[2,15,2,15,98,66,60,0],[0,0,18,31,34,18,4,0],[0,18,63,66,66,52,4,0],[0,0,17,61,83,57,17,0],[0,17,61,83,81,57,17,0],[0,8,56,8,28,42,4,0],[8,8,56,8,28,42,4,0],[30,0,2,58,70,66,48,0],[0,32,34,34,42,36,16,0],[31,8,60,66,73,84,56,0],[4,7,4,12,22,85,36,0],[63,16,8,60,66,65,48,0],[0,0,8,14,56,76,42,0],[4,7,4,60,70,69,36,0],[14,8,60,74,105,85,50,0],[6,60,66,57,4,54,73,0],[4,15,4,110,17,8,112,0],[8,8,4,12,86,82,33,0],[64,46,0,60,66,64,56,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[64,128,32,64,0,0,0,0],[64,160,64,0,0,0,0,0],[0,0,8,8,16,48,12,0],[32,64,20,36,8,24,6,0],[0,0,0,0,0,0,0,0]],lx=[[255,255,255,255,0,0,0,0],[0,0,0,0,0,0,0,255],[0,0,0,0,0,0,255,255],[0,0,0,0,0,255,255,255],[0,0,0,0,255,255,255,255],[0,0,0,255,255,255,255,255],[0,0,255,255,255,255,255,255],[0,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255],[127,127,127,127,127,127,127,127],[63,63,63,63,63,63,63,63],[31,31,31,31,31,31,31,31],[15,15,15,15,15,15,15,15],[7,7,7,7,7,7,7,7],[3,3,3,3,3,3,3,3],[1,1,1,1,1,1,1,1],[240,240,240,240,240,240,240,240],[85,0,170,0,85,0,170,0],[85,170,85,170,85,170,85,170],[255,170,255,85,255,170,255,85],[255,0,0,0,0,0,0,0],[128,128,128,128,128,128,128,128],[0,0,0,0,15,15,15,15],[0,0,0,0,240,240,240,240],[15,15,15,15,0,0,0,0],[15,15,15,15,255,255,255,255],[15,15,15,15,240,240,240,240],[255,255,255,255,15,15,15,15],[255,255,255,255,240,240,240,240],[240,240,240,240,0,0,0,0],[240,240,240,240,15,15,15,15],[240,240,240,240,255,255,255,255]],fx=[[0,4,8,127,3,63,3,127],[0,54,0,127,3,63,3,127],[0,31,6,62,102,102,102,54],[0,16,8,127,3,3,3,3],[0,62,99,3,15,3,99,62],[0,62,99,3,62,96,99,62],[0,126,24,24,24,24,24,126],[0,54,0,127,28,28,28,127],[0,120,96,96,96,99,99,62],[0,30,27,27,59,91,91,59],[0,27,27,27,63,91,91,59],[0,31,6,62,102,102,102,102],[0,16,8,99,51,31,51,99],[0,4,8,99,115,123,111,103],[0,20,8,99,54,60,24,15],[0,99,99,99,99,127,28,28],[0,28,54,99,99,127,99,99],[0,63,3,3,63,99,99,63],[0,63,99,99,63,99,99,63],[0,127,3,3,3,3,3,3],[0,62,54,54,54,54,127,99],[0,127,3,3,63,3,3,127],[0,107,107,62,28,62,107,107],[0,62,99,96,56,96,99,62],[0,99,115,123,107,111,103,99],[0,20,8,99,115,123,111,103],[0,99,51,27,15,27,51,99],[0,124,102,102,102,102,102,99],[0,99,119,127,107,99,99,99],[0,99,99,99,127,99,99,99],[0,62,99,99,99,99,99,62],[0,127,99,99,99,99,99,99],[0,63,99,99,63,3,3,3],[0,62,99,3,3,3,99,62],[0,126,24,24,24,24,24,24],[0,99,99,54,60,24,12,7],[0,8,62,107,107,107,62,8],[0,99,119,62,28,62,119,99],[0,51,51,51,51,51,127,96],[0,99,99,99,127,96,96,96],[0,107,107,107,107,107,107,127],[0,107,107,107,107,107,127,96],[0,7,6,62,102,102,102,62],[0,99,99,99,103,107,107,103],[0,3,3,3,63,99,99,63],[0,62,99,96,120,96,99,62],[0,57,109,109,111,109,109,57],[0,126,99,99,126,108,102,99],[0,0,0,62,96,126,99,126],[0,62,3,63,99,99,99,62],[0,0,0,63,99,63,99,63],[0,0,0,127,3,3,3,3],[0,0,0,62,54,54,127,99],[0,0,0,62,99,127,3,62],[0,0,0,107,107,62,107,107],[0,0,0,62,99,56,99,62],[0,0,0,99,115,123,111,103],[0,20,8,0,115,123,111,103],[0,0,0,99,51,31,51,99],[0,0,0,124,102,102,102,99],[0,0,0,99,119,127,107,99],[0,0,0,99,99,127,99,99],[0,0,0,62,99,99,99,62],[0,0,0,127,99,99,99,99],[0,0,0,63,99,63,3,3],[0,0,0,62,99,3,99,62],[0,0,0,126,24,24,24,24],[0,0,0,99,54,60,24,15],[0,0,8,62,107,107,62,8],[0,0,0,119,62,28,62,119],[0,0,0,51,51,51,127,96],[0,0,0,99,99,127,96,96],[0,0,0,107,107,107,107,127],[0,0,0,107,107,107,127,96],[0,0,0,7,6,62,102,62],[0,0,0,99,99,103,107,103],[0,0,0,3,3,63,99,63],[0,0,0,62,99,120,99,62],[0,0,0,57,109,111,109,57],[0,0,0,126,99,126,108,102],[0,4,8,62,99,127,3,62],[0,54,0,62,99,127,3,62],[0,15,6,62,102,102,102,48],[0,16,8,0,127,3,3,3],[0,0,0,62,99,15,99,62],[0,0,0,126,3,127,96,63],[0,24,0,30,24,24,24,127],[0,54,0,30,24,24,24,127],[0,96,0,96,96,96,99,62],[0,0,0,30,27,59,91,59],[0,0,0,27,27,63,91,59],[0,6,15,6,62,102,102,102],[0,16,8,0,99,51,31,115],[0,4,8,0,115,123,111,103],[0,20,8,0,54,60,24,15],[0,0,0,99,99,99,127,28],[0,54,65,65,93,73,62,20],[0,0,0,107,107,107,62,54],[0,4,31,4,60,100,100,60],[0,4,4,31,4,60,100,60],[0,51,91,27,63,27,91,51],[0,0,0,115,27,63,27,115],[0,8,28,54,99,127,107,107],[0,0,0,28,54,99,127,107],[0,17,57,109,69,127,85,85],[0,0,0,57,109,69,127,85],[0,127,99,54,8,62,107,107],[0,0,0,62,20,8,62,107],[0,125,69,41,17,63,85,85],[0,0,0,125,41,17,63,85],[0,99,115,51,51,51,30,12],[0,0,0,99,51,51,30,12],[0,99,115,51,51,51,30,12],[54,108,0,99,51,51,30,12],[0,62,99,3,3,30,24,24],[0,0,0,62,99,3,30,24],[0,64,104,48,90,12,22,2],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,6,15,6,62,102,102,62],[0,6,6,15,6,62,102,62],[0,63,99,107,63,19,3,3],[0,0,0,63,107,63,19,3],[0,64,127,3,3,3,3,3],[0,0,64,127,3,3,3,3],[0,126,6,6,31,6,6,6],[0,0,0,126,6,31,6,6],[0,63,3,63,99,99,96,63],[0,0,0,63,3,63,96,63],[0,107,62,28,62,107,107,64],[0,0,107,107,62,107,107,64],[0,62,99,56,99,62,8,12],[0,62,96,56,96,62,8,12],[0,115,27,15,27,51,99,64],[0,0,99,51,31,51,99,64],[0,97,53,29,15,29,53,97],[0,0,0,97,53,31,53,97],[0,98,55,26,14,26,50,98],[0,2,7,98,50,30,50,98],[0,103,54,30,14,30,54,102],[0,0,0,103,54,30,54,102],[0,51,51,63,51,51,115,64],[0,0,51,51,63,51,115,64],[0,115,51,51,63,51,51,51],[0,0,0,115,51,63,51,51],[0,15,9,57,73,73,73,32],[0,0,0,15,57,73,73,32],[0,38,81,81,81,81,33,94],[0,0,0,38,81,81,33,94],[0,62,99,3,99,62,8,12],[0,0,62,3,3,62,8,12],[0,126,24,24,24,24,56,32],[0,0,0,126,24,24,56,32],[0,102,102,102,60,24,24,24],[0,0,0,102,102,60,24,24],[0,99,99,99,54,28,127,28],[0,0,0,99,54,28,127,28],[0,119,62,28,62,119,99,64],[0,0,119,62,28,62,119,64],[0,47,34,34,34,34,126,64],[0,0,0,47,34,34,126,64],[0,51,51,63,48,48,112,64],[0,0,0,51,63,48,112,64],[0,99,107,107,127,104,104,96],[0,0,0,99,107,127,104,96],[0,3,3,63,99,99,99,99],[0,0,3,3,63,99,99,99],[0,56,108,109,127,12,76,56],[0,0,0,56,109,127,12,56],[0,56,108,109,127,12,56,16],[0,0,56,109,127,12,56,16],[0,126,24,24,24,24,24,126],[0,20,28,107,107,62,107,107],[0,20,28,0,107,62,107,107],[0,99,99,127,96,96,112,16],[0,0,0,99,127,96,112,16],[0,28,26,24,24,24,24,126],[0,20,28,28,54,99,127,99],[0,20,28,62,96,126,99,126],[0,54,0,28,54,99,127,99],[0,54,0,62,96,126,99,126],[0,124,30,27,123,31,27,123],[0,0,0,63,108,127,13,63],[0,20,28,127,3,31,3,127],[0,20,28,62,99,127,3,62],[0,30,51,96,127,99,54,28],[0,0,0,63,96,127,99,62],[0,30,51,96,127,99,54,28],[0,108,0,63,96,127,99,62],[0,54,0,107,107,62,107,107],[0,0,54,0,107,62,107,107],[0,62,99,96,56,96,99,62],[0,108,0,62,99,56,99,62],[0,63,48,24,56,99,99,62],[0,0,0,63,16,56,99,62],[0,62,0,99,115,123,111,103],[0,0,62,0,115,123,111,103],[0,54,0,99,115,123,111,103],[0,0,54,0,115,123,111,103],[0,54,0,62,99,99,99,62],[0,0,54,0,62,99,99,62],[0,62,99,99,127,99,99,62],[0,0,0,62,99,127,99,62],[0,62,99,99,127,99,99,62],[0,108,0,62,99,127,99,62],[0,62,99,96,120,96,99,62],[0,108,0,62,99,120,99,62],[0,62,0,99,54,60,24,15],[0,0,62,0,99,54,28,15],[0,54,0,99,54,60,24,15],[0,0,54,0,99,54,28,15],[0,20,20,99,54,60,24,15],[0,20,20,0,54,60,24,15],[0,54,0,99,99,127,96,96],[0,0,54,0,99,127,96,96],[0,127,3,3,3,3,7,4],[0,0,0,127,3,3,7,4],[0,99,99,99,103,107,107,103],[0,108,0,99,99,103,107,103]],Y=[{start:0,characters:sx},{start:160,characters:nx},{start:8592,characters:ox},{start:912,characters:ax},{start:12352,characters:cx},{start:9600,characters:lx},{start:1024,characters:fx}];var D0={"~":"waveY",_:"waveX","%":"shake","=":"shakeX","^":"shakeY","\xB0":"blink"},T=class i{#x;#t;#i;#e;#r;constructor(x,e,t){this.#i=x,this.#e=e,this.#r=t,this.#x=[{pattern:"\\\\.",type:"char",process:r=>r.charAt(1)},{pattern:this.#n(x),type:"char"},{pattern:"<.>",type:"color",process:r=>r.charAt(1)},{pattern:Object.keys(D0).map(this.#n).join("|"),type:"effect",process:r=>D0[r]},{pattern:"[^\\n\\r\\t]",type:"char"}],this.#t=new RegExp(this.#x.map(r=>`(${r.pattern})`).join("|"),"g");}parseText(x,e){let t=this.#s(x),r=this.#o(t);return this.#a(r,e)}draw(x,e,t,r,s){for(let n=0;n<e.length;n++){let a=e[n];if(a===void 0)continue;let o=t+n*8,c=r,l=a.color?p(a.color,this.#r):null;switch(l?x.fillStyle=l:x.fillStyle=this.#e,a.effect){case "waveY":c+=Math.floor(Math.sin(s*.01+n)*3);break;case "waveX":o+=Math.floor(Math.sin(s*.01+n)*2);break;case "shake":o+=Math.floor((Math.random()-.5)*2),c+=Math.floor((Math.random()-.5)*2);break;case "shakeX":o+=Math.floor((Math.random()-.5)*2);break;case "shakeY":c+=Math.floor((Math.random()-.5)*2);break;case "blink":Math.sin(s*.015)>0&&(x.fillStyle="transparent");break}i.#c(x,a.value,o,c);}}#s(x){let e=x.matchAll(this.#t),t=[];for(let r of e){r.shift();let s=r.findIndex(c=>c!==void 0),{type:n,process:a}=this.#x[s],o=a?a(r[s]):r[s];t.push({value:o,type:n});}return t}#o(x){let e=[],t=[],r=[];for(let s=0;s<x.length;s++){let n=x[s];if(!n)continue;let{type:a,value:o}=n;if(a==="char"){let c=t[t.length-1],l=r[r.length-1];e.push({value:o,color:c,effect:l});continue}if(n.type==="color"){let c=t.lastIndexOf(o);c!==-1?t.splice(c,1):t.push(o);continue}if(n.type==="effect"){let c=r.lastIndexOf(o);c!==-1?r.splice(c,1):r.push(o);}}return e}#a(x,e){let t=[];x:for(;x.length>0;){let r=x.findIndex((s,n)=>s.value===this.#i&&n<e);if(r!==-1){t.push(x.splice(0,r)),x.splice(0,1);continue}else if(x.length<=e){t.push(x),x=[];continue}for(let s=e;s>=0;s--)if(x[s]?.value===" "){t.push(x.splice(0,s)),x.splice(0,1);continue x}t.push(x.splice(0,e));}return x.length>0&&t.push(x),t}#n(x){return x.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}static#c(x,e,t,r){let s=e.charCodeAt(0),n=this.#l(s);if(n)for(let a=0;a<8;a++){let o=n[a];if(o!==void 0)for(let c=0;c<8;c++)o&1<<c&&x.fillRect(t+c,r+a,1,1);}}static text(x,e,t,r){for(let s=0;s<e.length;s++){let n=e.charAt(s);i.#c(x,n,t+s*8,r);}}static#l(x){let e=Y.find(t=>x>=t.start&&x<t.start+t.characters.length);return e?e.characters[x-e.start]:null}};function A(i){let x=new Map;return (t,...r)=>{let s=x.get(t);if(s)return s;let n=i(...r);return x.set(t,n),n}}var j=class i{x;y;constructor(x,e){this.x=x,this.y=e;}#x(...x){let[e]=x;return e instanceof i?e:d(...x)}get value(){return [this.x,this.y]}set value(x){this.x=x[0],this.y=x[1];}get length(){return Math.sqrt(this.x*this.x+this.y*this.y)}get direction(){return new i(Math.sign(this.x),Math.sign(this.y))}add(...x){let e=this.#x(...x);return new i(this.x+e.x,this.y+e.y)}sub(...x){let e=this.#x(...x);return new i(this.x-e.x,this.y-e.y)}multiply(x){return new i(this.x*x,this.y*x)}divide(x){return new i(this.x/x,this.y/x)}distance(...x){return this.#x(...x).sub(this).length}manhattanDistance(...x){let e=this.#x(...x);return Math.abs(e.x-this.x)+Math.abs(e.y-this.y)}equals(...x){let e=this.#x(...x);return e.x===this.x&&e.y===this.y}};function d(...i){let[x,e]=i;return typeof x=="number"?new j(x,e):new j(...x)}var I=class{canvas;#x;constructor(){if(this.canvas=document.createElement("canvas"),this.#x=this.canvas.getContext("2d"),!this.#x)throw new Error("Failed to get 2D context for screenshot canvas");this.update();}update(){let x=document.querySelector(`canvas.${V}`),e=document.querySelector(`canvas.${G}`),t=document.querySelector(`canvas.${U}`),r=document.querySelector(`canvas.${k}`),s=document.querySelector(`canvas.${M}`),n=[];x&&n.push(x),e&&n.push(e),t&&n.push(t),r&&n.push(r),s&&n.push(s);let a=0;n.forEach(l=>{a=Math.max(a,l.width,l.height);});let o=[];if(s&&s.style.display!=="none"){let l=this.#t(s);o.push(l);}else x&&o.push(x);if(e&&e.style.display!=="none"&&o.push(e),t&&t.style.display!=="none"&&o.push(t),r&&r.style.display!=="none"&&o.push(r),o.length===0)throw new Error("No visible canvas frames found for screenshot");this.canvas.width=a,this.canvas.height=a;let c=getComputedStyle(document.body).backgroundColor||"black";this.#x.fillStyle=c,this.#x.fillRect(0,0,a,a),this.#x.imageSmoothingEnabled=false,o.forEach(l=>{let f=Math.min(a/l.width,a/l.height),u=l.width*f,h=l.height*f,_=(a-u)/2,i0=(a-h)/2;this.#x.drawImage(l,_,i0,u,h);});}save(x){let e=this.canvas.toDataURL("image/png"),t=document.createElement("a");t.href=e,t.download=`${x}.png`,document.body.appendChild(t),t.click(),document.body.removeChild(t);}get dataUrl(){return this.canvas.toDataURL("image/png")}#t(x){let e=x.getContext("webgl",{preserveDrawingBuffer:true}),t=x.width,r=x.height,s=new Uint8Array(t*r*4);e?.readPixels(0,0,t,r,e.RGBA,e.UNSIGNED_BYTE,s);let n=t*4,a=new Uint8Array(n);for(let f=0;f<r/2;f++){let u=f*n,h=(r-f-1)*n;a.set(s.subarray(u,u+n)),s.copyWithin(u,h,h+n),s.set(a,h);}let o=new ImageData(new Uint8ClampedArray(s),t,r),c=document.createElement("canvas");return c.width=t,c.height=r,c.getContext("2d")?.putImageData(o,0,0),c}};var z=null,K=null,hx=()=>(z||(z=new Promise(i=>{K=i;})),z),g=()=>{K&&(K(),z=null,K=null);};var l0=null;function O0(i,x,e,t,r){l0=s=>{x.close(),e.close(),t.close(),i.clear(s);for(let n in r)delete r[n];};}function q(i){l0?.(i),l0=null,g();}var L0={player:{sprite:0},templates:{},map:`
		........
		........
		........
		........
		........
		........
		........
		........
	`,colors:["#212529","#f8f9fa","#ced4da","#228be6","#fa5252","#fcc419","#ff922b","#40c057","#f06595","#a52f01"],messageBackground:0,messageColor:1,dialogBackground:0,dialogColor:1,dialogBorder:1,dialogSpeed:"NORMAL",screenWidth:8,screenHeight:8,cellWidth:8,cellHeight:8,background:1,volume:.5,controls:{LEFT:["KeyA","ArrowLeft"],RIGHT:["KeyD","ArrowRight"],UP:["KeyW","ArrowUp"],DOWN:["KeyS","ArrowDown"],ACTION:["Enter","Space"]}};var f0=class{element;constructor({id:x,zIndex:e}){this.element=document.createElement("canvas"),this.element.style.setProperty("position","absolute"),this.element.style.setProperty("image-rendering","pixelated"),x&&this.element.classList.add(x),e&&this.element.style.setProperty("z-index",e.toString()),document.body.append(this.element),window.addEventListener("resize",this.#x);}show(){this.element.style.setProperty("display","block");}hide(){this.element.style.setProperty("display","none");}setSize(x,e){this.element.width=x,this.element.height=e,this.#x();}get2dCtx(){let x=this.element.getContext("2d");if(!x)throw new Error("failled to access context of the canvas");return x}getWebglCtx(){let x=this.element.getContext("webgl",{preserveDrawingBuffer:true});if(!x)throw new Error("failled to access context of the canvas");return x}#x=()=>{let x=this.element.width<this.element.height?"vertical":"horizontal",e=Math.min(window.innerWidth,window.innerHeight),t=x==="horizontal"?e:e/this.element.height*this.element.width,r=x==="vertical"?e:e/this.element.width*this.element.height,s=(window.innerWidth-t)*.5,n=(window.innerHeight-r)*.5;this.element.style.setProperty("width",`${t}px`),this.element.style.setProperty("height",`${r}px`),this.element.style.setProperty("left",`${s}px`),this.element.style.setProperty("top",`${n}px`);}},ux=A(i=>new f0(i)),b=i=>ux(i.id,i);var h0=class{#x;#t;#i;#e;#r;#s=[];#o=0;#a;#n=0;#c=0;#l;isOpen=false;#u;#m;#h;#f;#p;#d;#g;#b;constructor(x){this.#u=p(x.dialogBackground,x.colors),this.#m=p(x.dialogColor,x.colors),this.#h=p(x.dialogBorder,x.colors),this.#f=w0[x.dialogSpeed],this.#x=b({id:G,zIndex:10}),this.#x.setSize(384,384),this.#x.hide(),this.#t=this.#x.get2dCtx(),this.#d=28*8+8*2,this.#p=2*8+12*2+10*1,this.#g=(384-this.#d)*.5,this.#b=384-this.#p-Math.floor(384/15),this.#l=new T("|",this.#m,x.colors);}async open(x){if(!(x.length<=0))return this.isOpen=true,this.#x.show(),this.#e=this.#l.parseText(x,28),this.#r=this.#e.shift(),this.#s=new Array(2).fill(null).map(e=>[]),this.#y(),g(),new Promise(e=>{this.#i=()=>e();})}next(){this.#r&&this.#r.length>0||this.#o<1||(this.#r=this.#e?.shift(),this.#o=0,this.#s=this.#s.map(()=>[]),this.#r===void 0&&this.close());}#y=()=>{let x=performance.now();if(this.#a=requestAnimationFrame(this.#y),!(x-this.#c<15)){if(this.#c=x,x-this.#n>=this.#f){this.#n=x,this.#r?.length===0&&this.#o<1&&(this.#o++,this.#r=this.#e?.shift());let e=this.#r?.shift();e&&this.#s[this.#o]?.push(e);}this.#v(x);}};close(){this.isOpen=false,this.#x.hide(),this.#o=0,this.#i?.(),this.#a&&cancelAnimationFrame(this.#a),g();}#v=x=>{this.#T();let e=this.#g+8;for(let t=0;t<this.#s.length;t++){let r=this.#s[t];if(!r)continue;let s=this.#b+12+8*t+t*10;this.#l.draw(this.#t,r,e,s,x);}};#T(){this.#t.clearRect(0,0,384,384),this.#t.fillStyle=this.#h,this.#t.fillRect(this.#g-2,this.#b-2,this.#d+2*2,this.#p+2*2),this.#t.fillStyle=this.#u,this.#t.fillRect(this.#g,this.#b,this.#d,this.#p);}},U0=i=>new h0(i);var W0=({gameState:i,messageBox:x,camera:e})=>{let t=false;return {play:async(...r)=>{r.length&&x.open(r),t=true,e.reset(),i.turn.reset(),i.player.restoreSavedState(),i.cells.initCells();},get ending(){return t},set ending(r){t=r;}}};var m0=`attribute vec2 a_position;
varying vec2 v_texCoords;
void main() {
    gl_Position = vec4(a_position, 0.0, 1.0);
    v_texCoords = a_position * vec2(0.5, -0.5) + 0.5;
}
`;var p0=`precision mediump float;
varying vec2 v_texCoords;
uniform sampler2D u_texture;

void main() {
    gl_FragColor = texture2D(u_texture, v_texCoords);
}
`;var H0=`precision mediump float;
varying vec2 v_texCoords;
uniform sampler2D u_texture;
uniform vec2 u_size;
uniform float u_sideCount;
uniform float u_scale;
uniform float u_rotation;

#define PI 3.14159265359
#define TWO_PI 6.28318530718
#define CELL_SIZE 24.

void main() {
    float d = 0.0;
    vec2 uv = fract(v_texCoords * (u_size / CELL_SIZE));
    vec2 st = uv * 2. - 1.;

    float a = atan(st.x, st.y) + PI + u_rotation * TWO_PI;
    float r = TWO_PI / float(u_sideCount);

    d = cos(floor(.5 + a / r) * r - a) * length(st);

    float threshold = 1.0 - step(u_scale, d);
    gl_FragColor = texture2D(u_texture, v_texCoords) * threshold;
}
`;var V0=`precision mediump float;
varying vec2 v_texCoords;

uniform sampler2D u_texture;
uniform vec2 u_size;

uniform float u_warp;
uniform float u_lineWidth;
uniform float u_lineIntensity;
uniform float u_lineCount;

void main() {
    vec2 fragCoord = v_texCoords * u_size;
    vec2 uv = v_texCoords;

    vec2 dc = abs(0.5 - uv);
    dc *= dc;

    uv.x -= 0.5;
    uv.x *= 1.0 + dc.y * (0.3 * u_warp);
    uv.x += 0.5;

    uv.y -= 0.5;
    uv.y *= 1.0 + dc.x * (0.4 * u_warp);
    uv.y += 0.5;

    if (uv.x < 0.0 || uv.x > 1.0 || uv.y < 0.0 || uv.y > 1.0) {
        gl_FragColor = vec4(0.0);
    } else {
        float dist = abs(fract(uv.y * u_lineCount) - 0.5);
        float scanLine = min(step(u_lineWidth * .5, dist) + (1. - u_lineIntensity), 1.);

        vec3 color = texture2D(u_texture, uv).rgb;
        gl_FragColor = vec4(color * scanLine, 1.0);
    }
}
`;var B0=`precision mediump float;

varying vec2 v_texCoords;
uniform sampler2D u_texture;
uniform vec2 u_size;

uniform float u_scale;
uniform float u_intensity;

#define PI 3.14159265359
#define TWO_PI 6.28318530718
#define CELL_SIZE 24.

float mosaic(float scale) {
    float d = 0.0;
    vec2 uv = fract(v_texCoords * (u_size / CELL_SIZE));
    vec2 st = uv * 2. - 1.;

    float a = atan(st.x, st.y) + PI;
    float r = TWO_PI / 4.;

    d = cos(floor(.5 + a / r) * r - a) * length(st);

    return 1.0 - step(scale, d);
}

vec3 blur() {
    vec2 radius = CELL_SIZE / u_size;
    vec3 blur = vec3(0);
    float count = 0.;

    for (int j = 0; j < 16; j++) {
        float d = float(j) * TWO_PI / 16.;
        vec2 offset = vec2(cos(d), sin(d)) / (u_size / CELL_SIZE);
        blur += texture2D(u_texture, v_texCoords + offset).rgb;
        count++;
    }

    return blur / count;
}

void main() {
    vec3 color = texture2D(u_texture, v_texCoords).rgb;

    vec3 with_blur = mix(color, blur(), u_intensity);
    gl_FragColor = vec4(max(color, with_blur), 1.) * mosaic(u_scale);
}
`;var X0=`precision mediump float;

varying vec2 v_texCoords;
uniform sampler2D u_texture;
uniform vec2 u_size;

uniform float u_intensity;

#define PI 3.14159265359
#define TWO_PI 6.28318530718
#define CELL_SIZE 24.

vec3 blur() {
    vec2 radius = CELL_SIZE / u_size;
    vec3 blur = vec3(0);
    float count = 0.;
    
    for (int j = 0; j < 16; j++) {
        float d = float(j) * TWO_PI / 16.;
        vec2 offset = vec2(cos(d), sin(d)) / (u_size / CELL_SIZE);
        blur += texture2D(u_texture, v_texCoords + offset).rgb;
        count++;
    }
    return blur / count;
}

void main() {
    vec3 color = texture2D(u_texture, v_texCoords).rgb;
    vec3 with_blur = mix(color, blur(), u_intensity);
    gl_FragColor = vec4(max(color, with_blur), 1.);
}
`;var d0={fractal:{fragment:H0,settings:{sideCount:12,scale:.9,rotation:0}},crt:{fragment:V0,settings:{warp:.7,lineIntensity:.2,lineWidth:.6,lineCount:85}},neon:{fragment:B0,settings:{scale:.75,intensity:.8}},glow:{fragment:X0,settings:{intensity:.5}}},Y0=i=>{if("name"in i){let x=Object.assign({},d0[i.name].settings,i.settings);return {vertex:d0[i.name].vertex??m0,fragment:d0[i.name].fragment??p0,settings:x}}return {vertex:i.vertex??m0,fragment:i.fragment??p0,settings:i.settings}};var g0=class{canvas;#x;#t={};#i;#e;#r;#s;#o;#a=new Map;#n;constructor(x,e){if(this.#x=Y0(e),this.#x.settings)for(let n in this.#x.settings){let a=this.#x.settings?.[n];this.#t[n]=Array.isArray(a)?[...a]:a;}this.#i=x,this.canvas=b({id:M});let t=this.canvas.getWebglCtx();if(!t)throw new Error("WebGL not supported");this.#e=t;let r=this.#c(this.#e.VERTEX_SHADER,this.#x.vertex),s=this.#c(this.#e.FRAGMENT_SHADER,this.#x.fragment);this.#r=this.#l(r,s),this.#e.useProgram(this.#r),this.#n=this.#e.getAttribLocation(this.#r,"a_position"),this.#o=this.#u(),this.#s=this.#m(),this.#i.style.setProperty("display","none");}render(){this.canvas.show(),this.canvas.setSize(this.#i.width,this.#i.height),this.#p("size",[this.canvas.element.width,this.canvas.element.height]),this.#t&&Object.entries(this.#t).forEach(([x,e])=>{this.#p(x,e);}),this.#e.viewport(0,0,this.canvas.element.width,this.canvas.element.height),this.#e.clearColor(0,0,0,1),this.#e.clear(this.#e.COLOR_BUFFER_BIT),this.#h(),this.#e.bindBuffer(this.#e.ARRAY_BUFFER,this.#o),this.#e.enableVertexAttribArray(this.#n),this.#e.vertexAttribPointer(this.#n,2,this.#e.FLOAT,false,0,0),this.#e.drawArrays(this.#e.TRIANGLES,0,6);}setUniforms(x){for(let[e,t]of Object.entries(x))this.#t[e]=Array.isArray(t)?[...t]:t;}#c(x,e){let t=this.#e.createShader(x);if(this.#e.shaderSource(t,e),this.#e.compileShader(t),!this.#e.getShaderParameter(t,this.#e.COMPILE_STATUS)){let r=this.#e.getShaderInfoLog(t);throw this.#e.deleteShader(t),new Error(`Shader compilation failed:
${r}`)}return t}#l(x,e){let t=this.#e.createProgram();if(this.#e.attachShader(t,x),this.#e.attachShader(t,e),this.#e.linkProgram(t),!this.#e.getProgramParameter(t,this.#e.LINK_STATUS)){let r=this.#e.getProgramInfoLog(t);throw this.#e.deleteProgram(t),new Error(`Program link failed:
${r}`)}if(this.#e.validateProgram(t),!this.#e.getProgramParameter(t,this.#e.VALIDATE_STATUS))throw new Error("validating program"+this.#e.getProgramInfoLog(t));return t}#u(){let x=new Float32Array([1,1,-1,1,-1,-1,-1,-1,1,-1,1,1]),e=this.#e.createBuffer();if(this.#e.bindBuffer(this.#e.ARRAY_BUFFER,e),this.#e.bufferData(this.#e.ARRAY_BUFFER,x,this.#e.STATIC_DRAW),this.#e.bindBuffer(this.#e.ARRAY_BUFFER,null),!e)throw new Error("failed to create quad");return e}#m(){let x=this.#e.createTexture();if(this.#e.bindTexture(this.#e.TEXTURE_2D,x),this.#e.texParameteri(this.#e.TEXTURE_2D,this.#e.TEXTURE_WRAP_S,this.#e.CLAMP_TO_EDGE),this.#e.texParameteri(this.#e.TEXTURE_2D,this.#e.TEXTURE_WRAP_T,this.#e.CLAMP_TO_EDGE),this.#e.texParameteri(this.#e.TEXTURE_2D,this.#e.TEXTURE_MIN_FILTER,this.#e.NEAREST),this.#e.texParameteri(this.#e.TEXTURE_2D,this.#e.TEXTURE_MAG_FILTER,this.#e.NEAREST),this.#e.texImage2D(this.#e.TEXTURE_2D,0,this.#e.RGBA,this.#e.RGBA,this.#e.UNSIGNED_BYTE,this.#i),this.#e.bindTexture(this.#e.TEXTURE_2D,null),!x)throw new Error("failed to create texture");return x}#h(){this.#e.bindTexture(this.#e.TEXTURE_2D,this.#s),this.#e.texImage2D(this.#e.TEXTURE_2D,0,this.#e.RGBA,this.#e.RGBA,this.#e.UNSIGNED_BYTE,this.#i);}#f(x){let e=`u_${x}`;if(this.#a.has(e))return this.#a.get(e);let t=this.#e.getUniformLocation(this.#r,e);return t&&this.#a.set(e,t),t}#p(x,e){let t=this.#f(x);if(t){if(typeof e=="number"&&(e=[e]),e.length<1||e.length>4)throw new Error("setUniform supports 1\u20134 float values");switch(e.length){case 1:this.#e.uniform1f(t,e[0]);break;case 2:this.#e.uniform2f(t,e[0],e[1]);break;case 3:this.#e.uniform3f(t,e[0],e[1],e[2]);break;case 4:this.#e.uniform4f(t,e[0],e[1],e[2],e[3]);break}}}},j0=(i,x)=>x?new g0(i,x):(b({id:M}).hide(),null);var z0=(i,x,e,t,r,s,n)=>{let a={getCell:(o,c)=>i.cells.getCellAt(o,c),addToCell:(o,c,l)=>i.cells.setCellAt(o,c,l),setCell:(o,c,l)=>i.cells.updateCellAt(o,c,l),clearCell:(o,c)=>i.cells.getCellAt(o,c).remove(),getAll:o=>i.cells.getCells({symbol:o}),setAll:(o,c)=>i.cells.updateCells({symbol:o},c),player:i.player.facade,getCellAt:(o,c)=>i.cells.getCellAt(o,c),setCellAt:(o,c,l)=>i.cells.setCellAt(o,c,l),updateCellAt:(o,c,l)=>i.cells.updateCellAt(o,c,l),clearCellAt:(o,c)=>i.cells.getCellAt(o,c).remove(),getCells:o=>i.cells.getCells(o),setCells:(o,c)=>i.cells.setCells(o,c),updateCells:(o,c)=>i.cells.updateCells(o,c),clearCells:o=>i.cells.clearCells(o),sendMessageToCells:(o,c)=>i.cells.sendMessageToCells(o,c),openDialog:o=>x.open(o),prompt:(...o)=>e.open(...o),openMenu:o=>e.openMenu(o),openMessage:(...o)=>s.open(o),playSound:(...o)=>t.play(...o),end:(...o)=>r.play(...o),loadMap:(o,c)=>{c&&(i.player.position=[...c]),i.gameMap.map=o,i.player.saveCurrentState();},updateFilter:o=>{i.filterUniforms.set(o);},get width(){return i.gameMap.dimensions[0]},get height(){return i.gameMap.dimensions[1]},get turn(){return i.turn.value},clear:o=>{q(o);}};return O0(n,x,s,e,a),a};function Tx(i,x=0){let e=i.charCodeAt(0),t=Y.find(n=>e>=n.start&&e<n.start+n.characters.length);if(!t)return "";let r=t.characters[e-t.start];if(!r)return "";let s="";for(let n=0;n<8;n++){let a=r[n];if(a!==void 0){for(let o=0;o<8;o++)a&1<<o?s+=x:s+=".";s+=`
`;}}return s}function Cx(i){new I().save(i);}var K0=1e3/30,b0=class{#x;#t=[];#i;#e=0;#r;#s;constructor(){this.#r=["video/webm","video/webm,codecs=vp9","video/vp8","video/webm;codecs=vp8","video/webm;codecs=daala","video/webm;codecs=h264","video/mpeg"].find(e=>MediaRecorder.isTypeSupported(e))??"",this.#s=new I;let x=this.#s.canvas.captureStream(K0);this.#x=new MediaRecorder(x,{mimeType:this.#r}),this.#x.ondataavailable=e=>{this.#t.push(e.data);};}start(){this.#t=[],this.#x.start(100),this.#i=requestAnimationFrame(this.#o);}stop(){this.#i&&cancelAnimationFrame(this.#i),this.#x.stop();}save(x){let e=new Blob(this.#t,{type:this.#r}),t=URL.createObjectURL(e),r=document.createElement("a");r.style.display="none",r.href=t,r.download=x+".webm",document.body.appendChild(r),r.click(),document.body.removeChild(r);}#o=x=>{x-this.#e>K0&&(this.#s.update(),this.#e=x),this.#i=requestAnimationFrame(this.#o);}};function Px(){let i=new b0;return i.start(),x=>{i.stop(),i.save(x);}}function Ex(...i){let x=i.filter(a=>typeof a=="string");if(x.length===0)return "";let e=x.map(v),t=e.map(X),r=Math.max(...t.map(a=>a[0])),s=Math.max(...t.map(a=>a[1])),n=[...Array(s)].map(()=>[...Array(r)].map(()=>"."));for(let a of e)for(let o=0;o<s;o++){let c=a[o];if(c)for(let l=0;l<r;l++){let f=c[l];!f||!B.includes(f)||(n[o][l]=f);}}return n.map(a=>a.join("")).join(`
`)}var y0=class{#x;#t;#i;#e;constructor(x){this.#x=x.gameState,this.#t=x.soundPlayer,this.#i=x.dialog,this.#e=x.ender;}async update(x){this.#e.ending=false,this.#x.player.setDirection(x);let e=d(this.#x.player.position),t=e.add(_x[x]),r=new Set(this.#x.cells.get().filter(s=>s.onTurn).map(s=>s.id));if(this.#a(t.value)){let s=this.#x.cells.getCellAt(...t.value);s.solid||(await this.#x.cells.getEvent(...e.value,"onLeave")?.(),this.#x.player.position=t.value),this.#r(s),await this.#s(s),s.solid?await this.#x.cells.getEvent(...t.value,"onCollide")?.():await this.#x.cells.getEvent(...t.value,"onEnter")?.();}for(let s of this.#x.cells.get())r.has(s.id)&&await this.#x.cells.getEvent(...s.position,"onTurn")?.();this.#x.player.dispatchOnTurn(),this.#e.ending||this.#x.turn.next(),await this.#o(this.#x.cells.getCellAt(...t.value));}#r(x){let e=x.sound;if(e){let t=Array.isArray(e)?e:[e];this.#t.play(...t);}}async#s(x){x.dialog&&await this.#i.open(x.dialog);}async#o(x){let e=x.end;e&&(typeof e=="string"?await this.#e.play(e):typeof e=="boolean"&&e?this.#e.play():await this.#e.play(...e));}#a([x,e]){return x>=0&&e>=0&&x<this.#x.gameMap.dimensions[0]&&e<this.#x.gameMap.dimensions[1]}},_x={LEFT:[-1,0],RIGHT:[1,0],UP:[0,-1],DOWN:[0,1],ACTION:[0,0]},q0=i=>new y0(i);var w=class{#x;#t;constructor(x,e){this.#x=x,this.#t=e;}get sprite(){return this.#i()?.sprite??null}set sprite(x){this.#e("sprite",x);}get solid(){return this.#i()?.solid??false}set solid(x){this.#e("solid",x);}get sound(){return this.#i()?.sound??null}set sound(x){this.#e("sound",x);}get position(){return this.#i()?.position??[-1,-1]}get dialog(){return this.#i()?.dialog??null}set dialog(x){this.#e("dialog",x);}get visible(){return this.#i()?.visible??false}set visible(x){this.#e("visible",x);}get foreground(){return this.#i()?.foreground??false}set foreground(x){this.#e("foreground",x);}get end(){return this.#i()?.end??null}set end(x){this.#e("end",x);}get symbol(){return this.#i()?.symbol??null}get isOnScreen(){return this.#i()?.isOnScreen??false}remove(){this.#t.clearCellAt(...this.#x);}moveTo(x,e){this.#t.moveCell(this.#x,[x,e]),this.#x=[x,e];}#i(){return this.#t.get().find(x=>d(x.position).equals(this.#x))}#e(x,e){this.#t.updateCellAt(...this.#x,{[x]:e});}};var Z=class{#x=[];#t;#i;#e;constructor(x,e){this.#t=e,this.#i=x.templates,this.#e=y(),this.initCells(),e.subscribe(()=>this.initCells());}subscribe(x){this.#e.subscribe(x);}getCellAt(x,e){return new w([x,e],this)}clearCellAt(x,e){this.#x=this.#x.filter(t=>!d(t.position).equals([x,e])),this.#e.notify();}updateCellAt(x,e,t){for(let r=0;r<this.#x.length;r++){let s=this.#x[r];if(s&&s.position&&d(s.position).equals([x,e])){let n=Object.assign({},s,t);this.#x[r]=n;break}}this.#e.notify();}setCellAt(x,e,t){let r=this.#n(this.#i,t,[x,e]);r&&(this.#x=[...this.#x.filter(s=>!d([x,e]).equals(s.position)),this.#a(x,e,t,r)],this.#e.notify());}getCells(x){return this.#r(x).map(({position:e})=>new w(e,this))}updateCells(x,e){for(let t=0;t<this.#x.length;t++){let r=this.#x[t];if(!r||!this.#s(r,x))continue;let s=Object.assign({},r,e);this.#x[t]=s;}this.#e.notify();}clearCells(x){this.#x=this.#x.filter(e=>!this.#s(e,x)),this.#e.notify();}setCells(x,e){for(let t=0;t<this.#x.length;t++){let r=this.#x[t];if(!r||!this.#s(r,x))continue;let s=this.#n(this.#i,e,r.position);s&&(this.#x[t]=this.#a(...r.position,e,s));}this.#e.notify();}sendMessageToCells(x,e){for(let t=0;t<this.#x.length;t++){let r=this.#x[t];!r||!this.#s(r,x)||!r.onMessage||r.onMessage(new w(r.position,this),e);}}moveCell(x,e){d(x).equals(e)||(this.#x=this.#x.filter(t=>!d(t.position).equals(e)),this.#x=this.#x.map(t=>d(t.position).equals(x)?{...t,position:e}:t),this.#e.notify());}#r(x){return this.#x.filter(e=>this.#s(e,x))}#s(x,e){return !("x"in e&&e.x!==x.position[0]||"y"in e&&e.y!==x.position[1]||"sprite"in e&&e.sprite!==x.sprite||"solid"in e&&e.solid!==x.solid||"symbol"in e&&!(Array.isArray(e.symbol)?e.symbol:[e.symbol]).includes(x.symbol)||"visible"in e&&e.visible!==x.visible||"foreground"in e&&e.foreground!==x.foreground||"dialog"in e&&e.dialog!==x.dialog||"end"in e&&(typeof e.end!=typeof x.end||typeof e.end=="string"&&x.end!==e.end||typeof e.end=="boolean"&&x.end!==e.end||Array.isArray(e.end)&&(!Array.isArray(x.end)||e.end.join("")!==x.end.join("")))||"isOnScreen"in e&&e.isOnScreen!==x.isOnScreen)}getEvent(x,e,t){let r=this.#x.find(s=>s.position[0]===x&&s.position[1]===e)?.[t];if(r)return ()=>r(this.getCellAt(x,e))}get(){return this.#x}handleScreenEvents(x){let e=[],t=[];for(let r=0;r<this.#x.length;r++){let s=this.#x[r];if(!s)continue;let n=x.isOnScreen(s.position);s.isOnScreen!==n&&(this.#x[r].isOnScreen=n,n?t.push(this.getEvent(...s.position,"onScreenEnter")):e.push(this.getEvent(...s.position,"onScreenLeave")));}e.forEach(r=>{r&&r();}),t.forEach(r=>{r&&r();});}initCells(){this.#x=this.#o(v(this.#t.map),this.#i);}#o(x,e){let t=[];for(let r=0;r<x.length;r++){let s=x[r];if(s)for(let n=0;n<s.length;n++){let a=s[n];if(!a)continue;let o=this.#n(e,a,[n,r]);o&&t.push(this.#a(n,r,a,o));}}return t}#a(x,e,t,r){return {id:crypto.randomUUID(),symbol:t,sprite:r.sprite??null,position:[x,e],dialog:r.dialog??null,isOnScreen:false,end:r.end??null,sound:r.sound??null,solid:r.solid!==false,visible:r.visible!==false,foreground:r.foreground===true,onCollide:r.onCollide,onEnter:r.onEnter,onLeave:r.onLeave,onScreenEnter:r.onScreenEnter,onScreenLeave:r.onScreenLeave,onTurn:r.onTurn,onMessage:r.onMessage}}#n(x,e,t){let r=x[e];if(r)return typeof r=="function"?r(t):r}};var Q=class{#x;#t;constructor(x){this.#x=this.#i(x),this.#t=y();}subscribe(x){this.#t.subscribe(x);}get(){return this.#i(this.#x)}set(x){for(let[e,t]of Object.entries(x))this.#x[e]=Array.isArray(t)?[...t]:t;this.#t.notify();}#i(x){let e={};for(let t in x){let r=x[t];r!==void 0&&(e[t]=Array.isArray(r)?[...r]:r);}return e}};var J=class{#x;#t;constructor(x){this.#x=x,this.#t=y();}subscribe(x){return this.#t.subscribe(x)}get map(){return this.#x}set map(x){this.#x=x,this.#t.notify(this.#x);}get dimensions(){return X(v(this.#x))}};var x0=class{#x;#t;#i;#e;#r;#s;#o;#a;#n;#c=[0,0];constructor(x){this.#x=x.sprite??null,this.#t=x.position??[0,0],this.#i=x.visible??true,this.#e=x.sprite??null,this.#r=x.position??[0,0],this.#s=x.visible??true,this.#o=x.onTurn,this.#a=x.onInput,this.#n=y();}subscribe(x){return this.#n.subscribe(x)}saveCurrentState(){this.#x=this.#e,this.#t=[...this.#r],this.#i=this.visible;}restoreSavedState(){this.#e=this.#x,this.#r=[...this.#t],this.#s=this.#i,this.#n.notify();}dispatchOnTurn(){this.#o?.(this.facade);}dispatchOnInput(x){this.#a?.(x);}get visible(){return this.#s}set visible(x){this.#s=x,this.#n.notify();}get sprite(){return this.#e}get position(){return this.#r}set sprite(x){this.#e=x,this.#n.notify();}set position(x){this.#r=[...x],this.#n.notify();}get direction(){return this.#c}setDirection(x){switch(x){case "LEFT":this.#c=[-1,0];break;case "UP":this.#c=[0,-1];break;case "RIGHT":this.#c=[1,0];break;case "DOWN":this.#c=[0,1];break}}get facade(){let x=this;return {get sprite(){return x.sprite},set sprite(e){x.sprite=e;},get position(){return x.position},set position(e){x.position=e;},get direction(){return x.direction},get visible(){return x.visible},set visible(e){x.visible=e;}}}};var e0=class{#x=0;constructor(){}next(){this.#x++;}get value(){return this.#x}reset(){this.#x=0;}};var $0=i=>{let x=new J(i.map),e=new Q(i.filter?.settings??{}),t=new x0(i.player),r=new Z(i,x),s=new e0,n=y();return e.subscribe(()=>{n.notify();}),t.subscribe(()=>{n.notify();}),r.subscribe(()=>{n.notify();}),x.subscribe(()=>{n.notify();}),{player:t,cells:r,gameMap:x,filterUniforms:e,turn:s,subscribe:n.subscribe}};var v0=class{controls=[];lastKeysEvents=new Map;onInput;lastPointerEvent=0;pointerDelay=D;oldTouchX;oldTouchY;pointerId;isSliding=false;static get touchEventElement(){}constructor(){let x=document.createElement("div");x.classList.add("odyc-touchEvent"),x.style.setProperty("position","absolute"),x.style.setProperty("left","0"),x.style.setProperty("height","0"),x.style.setProperty("width","100vw"),x.style.setProperty("height","100vh"),x.style.setProperty("overflow","hidden"),x.style.setProperty("touch-action","none"),x.style.setProperty("z-index","999999999"),document.body.appendChild(x),document.body.style.setProperty("margin","0"),document.addEventListener("keydown",this.handleKeydown),x.addEventListener("pointerdown",this.handleTouch),x.addEventListener("pointerup",this.handleTouchUp),x.addEventListener("pointerleave",this.handleTouchLeave),x.addEventListener("pointercancel",this.handleTouchLeave),x.addEventListener("pointermove",this.handleTouchMove);}init(x,e){this.lastKeysEvents.clear(),this.lastPointerEvent=0,this.pointerDelay=D,this.oldTouchX=void 0,this.oldTouchY=void 0,this.pointerId=void 0,this.isSliding=false,this.controls=Object.entries(x.controls),this.onInput=e;}handleTouch=x=>{x.pointerType!=="mouse"&&(this.pointerId=x.pointerId,this.oldTouchX=x.clientX,this.oldTouchY=x.clientY);};handleTouchUp=x=>{this.pointerId===x.pointerId&&(this.pointerId=void 0,this.isSliding||this.onInput?.("ACTION"),this.isSliding=false,this.pointerDelay=D);};handleTouchLeave=x=>{this.pointerId===x.pointerId&&(this.pointerId=void 0,this.isSliding=false,this.pointerDelay=D);};handleTouchMove=x=>{if(this.pointerId!==x.pointerId)return;let e=x.clientX,t=x.clientY;if(e===void 0||t===void 0||this.oldTouchX===void 0||this.oldTouchY===void 0)return;let r=e-this.oldTouchX,s=t-this.oldTouchY,n=x.timeStamp;if(!(Math.abs(r)<o0&&Math.abs(s)<o0)&&!(n-this.lastPointerEvent<this.pointerDelay))if(this.lastPointerEvent=n,this.pointerDelay=n0+(this.pointerDelay-n0)*.6,this.oldTouchX=e,this.oldTouchY=t,this.isSliding=true,Math.abs(s)>Math.abs(r)){let a=Math.sign(s);this.onInput?.(a<0?"UP":"DOWN");}else {let a=Math.sign(r);this.onInput?.(a<0?"LEFT":"RIGHT");}};handleKeydown=x=>{let e=this.controls.find(([a,o])=>o===x.code||o.includes(x.code));if(!e)return;let[t]=e,r=x.timeStamp,s=this.lastKeysEvents.get(x.code);if(x.repeat&&s&&r-s.timestamp<s.delay)return;let n=x.repeat&&s?s0+(s.delay-s0)*.6:R0;this.lastKeysEvents.set(x.code,{delay:n,timestamp:r}),this.onInput?.(t);}},Sx=A(()=>new v0),Z0=(i,x)=>{let e=Sx(null);return e.init(i,x),e};var T0=class{#x;#t;isOpen=false;#i;#e=[];#r=[];#s;#o;#a=0;#n;#c=0;#l;#u;#m;#h;#f=192;#p=1;#d=2;constructor(x){this.#u=x.colors,this.#m=p(x.messageBackground,x.colors),this.#h=p(x.messageColor,x.colors),this.#s=Math.floor((this.#f-2*this.#p)/8),this.#o=Math.floor(this.#f/(8+this.#d)),this.#x=b({id:k,zIndex:10}),this.#x.hide(),this.#t=this.#x.get2dCtx(),this.#x.setSize(this.#f,this.#f),this.#l=new T(`
`,this.#h,this.#u);}open(x){let e=typeof x=="string"?[x]:[...x];if(e.length===0||e[0]?.length===0)return;this.isOpen=true,this.#e=e;let t=this.#e[this.#a];if(t)return this.#r=this.#l.parseText(t,this.#s),this.#x.show(),this.#g(),g(),new Promise(r=>this.#i=()=>r())}next(){this.#a++;let x=this.#e[this.#a];x?(this.#r=this.#l.parseText(x,this.#s),this.#n=requestAnimationFrame(this.#g)):this.close();}#g=()=>{let x=performance.now();this.#n=requestAnimationFrame(this.#g),!(x-this.#c<15)&&this.#b(x);};#b(x){this.#t.clearRect(0,0,this.#f,this.#f),this.#t.fillStyle=this.#m,this.#t.fillRect(0,0,this.#f,this.#f),this.#t.fillStyle=this.#h;let e=Math.min(this.#r.length,this.#o),t=e*8+(e-1)*this.#d,r=(this.#f-t)*.5;for(let s=0;s<e;s++){let n=this.#r[s];if(!n)continue;let a=n.length*8,o=(this.#f-a)*.5,c=r+s*8+s*this.#d;this.#l.draw(this.#t,n,o,c,x);}}close=()=>{this.#a=0,this.#r=[],this.isOpen=false,this.#n&&cancelAnimationFrame(this.#n),this.#x.hide(),this.#i?.(),g();}},Q0=i=>new T0(i);var C0=class{#x;#t;#i;isOpen=false;#e=[];#r=0;#s;#o;#a;#n;constructor(x){this.#s=x.colors,this.#o=this.#h(x.dialogBackground),this.#a=this.#h(x.dialogColor),this.#n=this.#h(x.dialogBorder),this.#x=b({id:U,zIndex:10}),this.#x.setSize(C,C),this.#x.hide(),this.#t=this.#x.get2dCtx();}get#c(){let x=a0*8+S*2,e=(C-x)*.5,t=Math.floor(C/15),r=Math.max(Math.ceil(this.#e.length/m),2),s=r*O+H*2+W*(r-1);return {left:e,top:t,width:x,height:s}}async openMenu(x){let e=Object.keys(x),t=e[await this.open(...e)];if(!t||!(t in x))return;let r=x[t];if(r)return typeof r=="function"?r():await this.openMenu(r)}async open(...x){return x.length?(this.#r=0,this.isOpen=true,this.#x.show(),this.#e=x,this.#l(),g(),new Promise(e=>{this.#i=t=>e(t);})):-1}input(x){let e=Math.ceil(this.#e.length/m),t=Math.floor(this.#r/m),r=this.#r-t*m;switch(x){case "LEFT":r=Math.max(0,r-1);break;case "UP":t=Math.max(0,t-1);break;case "RIGHT":r=Math.min(r+1,m-1);break;case "DOWN":t=Math.min(t+1,e-1);break;case "ACTION":this.close();return}this.#r=Math.min(t*m+r,this.#e.length-1),this.#l();}close(){this.isOpen=false,this.#x.hide(),this.#i?.(this.#r),g();}#l(){this.#m();let{left:x,top:e,width:t}=this.#c;this.#t.fillStyle=this.#a;let r=Math.ceil(a0/m-m);for(let s=0;s<this.#e.length;s++){let n=this.#e[s]?.slice(0,r);if(!n)continue;let a=Math.floor(s/m),o=s-a*m,c=x+S+o*(t-S*2)/m+(o+1)*O,l=e+H+8*a+a*W;T.text(this.#t,n,c,l);}this.#u();}#u(){let x=Math.floor(this.#r/m),e=this.#r-x*m,{left:t,top:r,width:s}=this.#c,n=t+S+e*(s-S*2)/m+e*O,a=r+H+8*x+x*W;for(let o=0;o<O/2;o++)this.#t.fillRect(n+o,a+o,1,8-2*o);}#m(){this.#t.clearRect(0,0,C,C),this.#t.fillStyle=this.#n;let{left:x,top:e,height:t,width:r}=this.#c;this.#t.fillRect(x-L,e-L,r+L*2,t+L*2),this.#t.fillStyle=this.#o,this.#t.fillRect(x,e,r,t);}#h(x){return typeof x=="string"?x:this.#s[x]??"black"}},J0=i=>new C0(i);var P0=class{canvas;#x=24;screenWidth;screenHeight;cellWidth;cellHeight;colors;ctx;background;constructor(x){this.screenWidth=x.screenWidth,this.screenHeight=x.screenHeight,this.cellWidth=x.cellWidth,this.cellHeight=x.cellHeight,this.colors=x.colors,this.background=x.background,this.canvas=b({id:V}),this.canvas.show(),this.ctx=this.canvas.get2dCtx();}render(x,e,t){this.clear();let r=false;for(let s of e)s.foreground&&s.position[0]===x.position[0]&&s.position[1]===x.position[1]?(x.visible&&this.#t(x,t),this.#t(s,t),r=true):this.#t(s,t);r||this.#t(x,t);}clear(x){this.canvas.setSize(this.cellWidth*this.screenWidth*this.#x,this.cellHeight*this.screenHeight*this.#x);let e=x??this.background;e!==void 0&&(typeof this.background=="number"?this.ctx.fillStyle=this.colors[this.background]??this.colors[0]??"black":this.ctx.fillStyle=p(e,this.colors),this.ctx.fillRect(0,0,this.screenWidth*this.cellWidth*this.#x,this.screenHeight*this.cellHeight*this.#x));}#t(x,e){if(x.sprite===void 0||x.sprite===null||x.visible===false||!e.isOnScreen(x.position))return;let[t,r]=x.position,[s,n]=e.position,a=(t-s)*this.cellWidth,o=(r-n)*this.cellHeight;if(a+this.cellWidth<0||o+this.cellHeight<0||a>this.screenWidth*this.cellWidth||o>this.screenHeight*this.cellHeight)return;let c=x.sprite;if(typeof c=="number"||c.length===1){let f=p(c,this.colors);if(!f)return;this.ctx.fillStyle=f,this.ctx.fillRect(Math.floor(a)*this.#x,Math.floor(o)*this.#x,this.cellWidth*this.#x,this.cellHeight*this.#x);return}let l=v(c);for(let f=0;f<this.cellHeight;f++)for(let u=0;u<this.cellWidth;u++){let h=l[f]?.charAt(u);if(!h)continue;let _=p(h,this.colors);_&&(this.ctx.fillStyle=_,this.ctx.fillRect(Math.floor(a+u)*this.#x,Math.floor(o+f)*this.#x,this.#x,this.#x));}}},xx=i=>new P0(i);var ex={waveForm:[{name:"waveForm",defaultValue:0,type:"radio",options:[{value:0,label:"Sine"},{value:1,label:"SawTooth"},{value:2,label:"Square"},{value:3,label:"Triangle"}]}],volume:[{name:"volume",min:0,max:1,step:.01,type:"range",defaultValue:.5}],soundEnveloppe:[{name:"attackTime",min:0,max:2,step:.01,type:"range",defaultValue:0},{name:"sustainTime",min:0,max:2,step:.01,type:"range",defaultValue:.07},{name:"sustainPunch",min:0,max:1,step:.01,type:"range",defaultValue:0},{name:"decayTime",min:0,max:2,step:.01,type:"range",defaultValue:.3}],pitch:[{name:"frequency",min:0,max:4e3,step:1,type:"range",defaultValue:700},{name:"pitchDelta",min:-4e3,max:4e3,step:1,type:"range",defaultValue:0},{name:"pitchDuration",min:0,max:1,step:.01,type:"range",defaultValue:1},{name:"pitchDelay",min:0,max:1,step:.01,type:"range",defaultValue:0}],vibrato:[{name:"vibratoRate",min:0,max:70,step:1,type:"range",defaultValue:0},{name:"vibratoDepth",min:0,max:100,step:1,type:"range",defaultValue:0}],tremolo:[{name:"tremoloRate",min:0,max:70,step:1,type:"range",defaultValue:0},{name:"tremoloDepth",min:0,max:1,step:.01,type:"range",defaultValue:0}],filters:[{name:"highPassCutoff",min:0,max:4e3,step:.1,type:"range",defaultValue:0},{name:"highPassResonance",min:0,max:30,step:.1,type:"range",defaultValue:0},{name:"lowPassCutoff",min:0,max:4e3,step:.1,type:"range",defaultValue:4e3},{name:"lowPassResonance",min:0,max:30,step:.1,type:"range",defaultValue:0}],phaser:[{name:"phaserBaseFrequency",min:0,max:1e3,step:1,type:"range",defaultValue:100},{name:"phaserLfoFrequency",min:0,max:200,step:1,type:"range",defaultValue:50},{name:"phaserDepth",min:0,max:1e3,step:1,type:"range",defaultValue:0}],noise:[{name:"noiseAmount",min:0,max:500,step:1,type:"range",defaultValue:0}]},R=Object.values(ex).flatMap(i=>[...i]),t0=R.reduce((i,x)=>({...i,[x.name]:x.defaultValue}),{}),Ax=(i,{noiseAmount:x})=>{let e=i.createWaveShaper(),t=44100,r=new Float32Array(t),s=Math.PI/180;for(let n=0;n<t;n++){let a=n*2/t-1;r[n]=(3+Math.random()*x)*a*20*s/(Math.PI+Math.random()*x*Math.abs(a));}return e.curve=r,e.oversample="4x",{input:e,output:e}},Ix=(i,{attackTime:x,sustainTime:e,sustainPunch:t,decayTime:r})=>{let s=i.createGain(),n=i.currentTime;return s.gain.setValueAtTime(0,n),s.gain.linearRampToValueAtTime(1-t,n+x),s.gain.setValueAtTime(1,n+x),s.gain.linearRampToValueAtTime(1-t,n+x+e),s.gain.linearRampToValueAtTime(0,n+x+e+r),{input:s,output:s}},wx=(i,{highPassCutoff:x,highPassResonance:e})=>{let t=i.createBiquadFilter();return t.type="highpass",t.frequency.value=x,t.Q.value=e,{input:t,output:t}},Rx=(i,{lowPassCutoff:x,lowPassResonance:e})=>{let t=i.createBiquadFilter();return t.type="lowpass",t.frequency.value=x,t.Q.value=e,{input:t,output:t}},Mx=(i,x,e)=>Math.min(Math.max(i,x),e),Dx=(i,x)=>Math.round(i*10**x)/10**x,Ox=["sine","sawtooth","square","triangle"],Lx=ex.pitch[0].max,Nx=(i,x,{waveForm:e,frequency:t,pitchDelta:r,pitchDuration:s,pitchDelay:n})=>{let a=x*n,o=(x-a)*s,c=i.createOscillator();return c.type=Ox[e]??"sine",c.frequency.setValueAtTime(t,i.currentTime),c.frequency.linearRampToValueAtTime(t,i.currentTime+a),c.frequency.linearRampToValueAtTime(Mx(0,t+r,Lx),i.currentTime+a+o),{input:c,output:c,start:()=>c.start(),stop:l=>c.stop(l)}},Fx=(i,{phaserBaseFrequency:x,phaserLfoFrequency:e,phaserDepth:t})=>{let r=i.createBiquadFilter();r.type="allpass",r.frequency.value=x;let s=i.createOscillator();s.type="sine",s.frequency.value=e;let n=i.createGain();return n.gain.value=t,s.connect(n),n.connect(r.frequency),{input:r,output:r,start:()=>s.start(),stop:a=>s?.stop(a)}},tx=(i,x,e)=>{let t=i.createOscillator(),r=i.createGain();return t.frequency.value=e,r.gain.value=x,t.connect(r),{input:t,output:r,start:()=>t.start(),stop:s=>t.stop(s)}},Gx=(i,{tremoloDepth:x,tremoloRate:e})=>tx(i,x,e),kx=(i,{vibratoDepth:x,vibratoRate:e})=>tx(i,x,e),Ux=(i,{volume:x})=>{let e=i.createGain();return e.gain.value=x,{input:e,output:e}},ix=(i,x,e)=>{let t=Object.assign({},t0,i),r=t.attackTime+t.sustainTime+t.decayTime,s=Nx(x,r,t),n=Ax(x,t),a=Ix(x,t),o=kx(x,t),c=Gx(x,t),l=Rx(x,t),f=wx(x,t),u=Fx(x,t),h=Ux(x,t);o.output.connect(s.input.frequency),c.output.connect(a.input),s.output.connect(n.input),n.output.connect(u.input),u.output.connect(l.input),l.output.connect(f.input),f.output.connect(a.input),a.output.connect(h.input),h.output.connect(e);let _=[o,c,s,u,l,a];return new Promise(i0=>{_.forEach(A0=>{A0.start?.(),A0.stop?.(x.currentTime+r);}),s.output.onended=()=>i0();})},E0=i=>{let x={...t0},e=i.searchParams.get("fx");if(!e)return x;let t=decodeURI(e).split(",");for(let r=0;r<R.length;r++){let s=R[r]?.name,n=t[r];s&&n&&!isNaN(Number(n))&&(x[s]=Number(n));}return x};var Wx=class{seed;#x;#t;#i;#e;constructor(i){this.seed=i??Date.now(),this.#x=this.seed&4294967295,this.#t=362436069,this.#i=521288629,this.#e=88675123;for(let x=0;x<32;x++)this.#r();}#r(){let i=this.#x^this.#x<<11&4294967295;return this.#x=this.#t,this.#t=this.#i,this.#i=this.#e,this.#e=this.#e^this.#e>>>19^(i^i>>>8),this.#e+2147483648}number(i,x){return i===void 0?(i=0,x=1):x===void 0&&(x=i,i=0),i+(x-i)*this.#r()/4294967295}boolean(i=.5){return this.number(0,1)<i}fromArray(i){return i[Math.floor(this.number(0,i.length))]}},Hx=i=>(R.forEach(x=>{let e=i[x.name];if(x.type==="range"&&e){let t=x.step.toString().split(".")[1]?.length??0;i[x.name]=Dx(e,t);}}),Object.assign({},t0,i)),_0=(i,x)=>Hx(i(new Wx(x))),F={DEFAULT:()=>({}),PICKUP:i=>({...i.boolean()?{pitchDelta:i.number(100,500),pitchDuration:0,pitchDelay:i.number(0,.7)}:{},waveForm:i.fromArray([0,1,2,3]),sustainPunch:i.number(0,.8),sustainTime:i.number(.05,.2),decayTime:i.number(.1,.3),frequency:i.number(900,1700)}),LASER:i=>{let x=i.number(100,1300);return {waveForm:i.fromArray([0,1,2,3]),sustainPunch:i.number(0,.8),sustainTime:i.number(.05,.1),decayTime:i.number(0,.2),frequency:x,pitchDelta:i.number(-x,-100),pitchDuration:1,pitchDelay:i.fromArray([0,i.number(0,.3)])}},JUMP:i=>({waveForm:i.fromArray([1,2]),sustainPunch:i.number(0,.8),sustainTime:i.number(.2,.5),decayTime:i.number(.1,.2),frequency:i.number(100,500),pitchDelta:i.number(200,500),pitchDuration:1,pitchDelay:i.fromArray([0,i.number(0,.3)])}),FALL:i=>{let x=i.number(80,500);return {waveForm:i.fromArray([1,2,3]),sustainPunch:0,sustainTime:i.number(.2,.5),decayTime:i.number(.2,.5),frequency:x,pitchDelta:-x,pitchDuration:1,pitchDelay:i.number(0,.2),vibratoRate:i.number(8,18),vibratoDepth:i.number(10,30),tremoloRate:i.number(5,18),tremoloDepth:i.number(0,1)}},POWERUP:i=>({waveForm:i.fromArray([0,1,2,3]),sustainPunch:i.number(0,1),sustainTime:i.number(.2,.5),decayTime:i.number(.1,.5),frequency:i.number(200,1e3),pitchDelta:i.number(100,300),pitchDuration:1,pitchDelay:i.fromArray([0,i.number(0,.3)]),vibratoRate:i.number(10,18),vibratoDepth:i.number(50,100)}),EXPLOSION:i=>{let x=i.number(200);return {waveForm:i.fromArray([0,1,2,3]),volume:.3,sustainPunch:i.number(0,.3),sustainTime:i.number(.4,1.3),decayTime:i.number(.1,.5),frequency:x,pitchDelta:-x,pitchDuration:1,pitchDelay:i.number(.3),vibratoRate:i.number(0,70),vibratoDepth:i.number(0,100),tremoloRate:i.number(0,70),tremoloDepth:i.number(0,1),phaserDepth:i.number(300,1e3),noiseAmount:i.number(300,500)}},BLIP:i=>({waveForm:i.fromArray([0,1,2,3]),sustainTime:i.number(.02,.1),decayTime:i.number(0,.04),frequency:i.number(600,3e3)}),HIT:i=>{let x=i.number(20,500);return {waveForm:i.fromArray([0,1,2,3]),sustainTime:i.number(.01,.03),sustainPunch:i.number(.5),decayTime:i.number(0,.2),frequency:x,pitchDelta:i.number(-x,-x*.2),noiseAmount:i.number(100)}},FART:i=>{let x=i.number(30,150);return {waveForm:1,volume:.7,sustainPunch:i.number(0,.2),sustainTime:i.number(.1,.5),decayTime:i.number(.3,.5),frequency:x,pitchDelta:-x/2,pitchDuration:1,pitchDelay:.1,vibratoRate:i.number(8,18),vibratoDepth:i.number(10,30),tremoloRate:i.number(35,70),tremoloDepth:i.number(.6,1),lowPassCutoff:x*10,lowPassResonance:10,noiseAmount:i.number(0,30)}},RANDOM:i=>{let x={...t0};for(let e=0;e<R.length;e++){let t=R[e];t&&(t.type==="range"?x[t.name]=i.number(t.min,t.max):t.type==="radio"&&(x[t.name]=i.fromArray(t.options.map(r=>r.value))));}return x}};var S0=class{#x;#t;#i=false;constructor(){this.#x=new AudioContext,this.#t=this.#x.createGain(),this.#t.connect(this.#x.destination);}set volume(x){this.#t.gain.value=x;}async play(...x){if(this.#i)return;this.#i=true;let e=this.#e(...x);return ix(e,this.#x,this.#t).then(()=>{this.#i=false;})}#e(...x){let[e,t]=x;return typeof e!="string"?e:c0(e)?E0(new URL(e)):e in F?_0(F[e],t):{}}},Vx=A(()=>new S0),rx=i=>{let x=Vx(null);return x.volume=i.volume,x},Bx=(...i)=>{let[x,e]=i;return c0(x)?E0(new URL(x)):x in F?_0(F[x],e):{}};var Yx=i=>{let x=Object.assign({},L0,i),e=$0(x),t=rx(x),r=I0(x),s=xx(x),n=U0(x),a=J0(x),o=Q0(x),c=j0(s.canvas.element,x.filter),l=W0({gameState:e,messageBox:o,camera:r}),f=M0(()=>{c?.setUniforms(e.filterUniforms.get()),r.update(e.player.position,e.gameMap.dimensions),s.render(e.player,e.cells.get(),r),c?.render(),e.cells.handleScreenEvents(r),g();},60),u=q0({gameState:e,soundPlayer:t,dialog:n,ender:l});return Z0(x,h=>{a.isOpen?a.input(h):o.isOpen?h==="ACTION"&&o.next():n.isOpen?h==="ACTION"&&n.next():(h!=="ACTION"&&u.update(h),e.player.dispatchOnInput(h));}),e.subscribe(f),q(),x.title&&o.open(x.title),f(),z0(e,n,a,t,l,o,s)};var Mi={gitHash:"67b5c26",version:"0.0.122"};exports.__BUILD_INFO__=Mi;exports.charToSprite=Tx;exports.createGame=Yx;exports.createSound=Bx;exports.makeScreenshot=Cx;exports.mergeSprites=Ex;exports.startRecording=Px;exports.tick=hx;exports.vec2=d;return exports;})({});
    const {createGame, createSound, charToSprite, vec2, makeScreenshot, startRecording, tick, mergeSprites} = odyc
//startofthegame
const levels = [{
    message: 'You figured out the maze!',
    map: `
      XEXXXXXXXXXXXXXXXXXXXXXX
      X.XXXXXXXXXXXXXXXXXXXXXX
      X.X..................XXX
      X.X.X.XXXXXX.XXXXXXX.XXX
      X...X.XXXXXX.XXXXXXX.XXX
      XXX.X.XXXXXX.XXXXXXX.XXX
      XXX.X.XXXXXX.XXXXXXX.XXX
      XXX.X.XXXXXX.XXXXXXX.XXX
      XXX.X.XXXXXX.XXXXXXX.XXX
      XXX.X........X.......XXX
      XXXXXXXXXXXXXX.XXXXXXXXX
      X..............XXXXXXXXX
      X.XXXXXXX.XXXXXXXXXXXXXX
      X.XXXXXXX.XXXXXXXXXXXXXX
      X.....................XX
      XXXXXXXXX.XXXXXXXXXXXXXX
      XXXXXXXXX.XXXXXXXXXXXXXX
      XXX.................XXXX
      XXX.XXXXX.XXXXXXXXX.XXXX
      XXX.XXXXX...........XXXX
      XXX.XXXXXXXXXXXXXXXXXXXX
      XXX.XX................XX
      XXX....XXXXXXXXXXXXXX.XX
      XXXXXXXXXXXXXXXXXXXXXEXX
  `,
    playerPos: [16, 17]
  },
  {
    message: 'You figured out the maze!',
    map: `
    	XXXXXXXXXXXXXXXXXXXXXXXX
    	XXXXXXXXXXXXXXXXXXXXXXXX
    	XXXXXXXXXXXXXXXXXXXXXXXX
    	XXXXXxXXXXXX.XXXXXXXXXXX
    	XXXXXXXXXXXX.XXXXXXXXXXX
    	XXXXXXXXXXXX.XXXXXXXXXXX
    	XXXXXXXXXXXX.XXXXXXXXXXX
    	XXXXXXXXXXXX.XXXXXXXXXXX
    	XXXXXXXXXXXX.XXXXXXXXXXX
    	XXXXXXXXXXXX.........XXX
    	XXXXXXXXXXXXXX.XXXXXXXXX
    	X..............XXXXXXXXX
    	X.XXXXXXX..............E
    	X.XXXXXXX.XXXXXXXXXXXXXX
    	X.........XXXXXXXXXXXXXX
    	XXXXXXXXX.XXXXXXXXXXXXXX
    	XXXXXXXXX.XXXXXXXXXXXXXX
    	XXXXXXXXX..........XXXXX
    	XXXXXXXXX.XXXXXXXXXXXXXX
    	XXXXXXXXX..........XXXXX
    	XXXXXXXXXXXXXXXXXXXXXXXX
    	XXXXXXXXXXXXXXXXXXXXXXXX
    	XXXXXXXXXXXXXXXXXXXXXXXX
    	XXXXXXXXXXXXXXXXXXXXXXXX
			`,
    playerPos: [18, 19]
  }
]

let currentLevel = 0;

const setGame = (level) => {
  const game = createGame({
    player: {
      sprite: `
			...13...
			...35...
			..3393..
			33993333
			..9933..
			..3393..
			..3..3..
			..3..3..
			`,
      position: level.playerPos
    },
    templates: {
      X: {
        sprite: `
			33.33.3.
			33333333
			33333333
			........
			.3.33.33
			33333333
			33333333
			........
			`
      },
      E: {
        onCollide: async () => {
          currentLevel++;
          if (currentLevel === levels.length) {
            game.end("You went through all the mazes!")
            currentLevel = 0;
          } else {
            await game.openDialog(level.message);
            setGame(levels[currentLevel]);
          }
        }
      }
    },
    map: level.map,
    background: 0,
    screenWidth: 12,
    screenHeight: 12,
    cameraWidth: 4,
    cameraHeight: 4
  })
};

setGame(levels[currentLevel]);
//endofthegame
    
  </script>
</body>
</html>
