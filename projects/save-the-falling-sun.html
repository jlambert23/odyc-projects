
<html>
<head>
  <meta charset="utf-8" />
</head>
<body>
  <script src="../utils/swipe-controls/swipe-controls.js"></script>
  
  <script>
    var odyc = (function (exports) {
    'use strict';

    var $=class{#e;#t;#r;position=[0,0];#x;#i;constructor(x){this.#x=x.screenWidth,this.#i=x.screenHeight,x.cameraWidth&&x.cameraHeight&&(this.#t=x.cameraWidth,this.#r=x.cameraHeight,this.#e={left:(x.screenWidth-this.#t)*.5,right:(x.screenWidth+this.#t)*.5-1,top:(x.screenHeight-this.#r)*.5,bottom:(x.screenHeight+this.#r)*.5-1});}update(x,e){let[t,i]=x;if(!this.#e||!this.#x||!this.#i){this.position[0]=Math.floor(t/this.#x)*this.#x,this.position[1]=Math.floor(i/this.#i)*this.#i,this.#n(e);return}let[n,s]=this.position,a=t-n,o=i-s;a<this.#e.left&&(this.position[0]-=this.#e.left-a),a>this.#e.right&&(this.position[0]+=a-this.#e.right),o<this.#e.top&&(this.position[1]-=this.#e.top-o),o>this.#e.bottom&&(this.position[1]+=o-this.#e.bottom),this.#n(e);}isOnScreen(x){let[e,t]=x,i=e-this.position[0],n=t-this.position[1];return i>=0&&n>=0&&i<this.#x&&n<this.#i}reset(){this.position=[0,0];}#n(x){let[e,t]=x;this.position[0]=Math.max(0,Math.min(this.position[0],e-this.#x)),this.position[1]=Math.max(0,Math.min(this.position[1],t-this.#i));}},g0=r=>new $(r);var Z=null;function b0(r,x,e,t,i){Z=n=>{x.close(),e.close(),t.close(),r.clear(n);for(let s in i)delete i[s];};}function O(r){Z?.(r),Z=null;}var y0={player:{sprite:0},templates:{},map:`
		........
		........
		........
		........
		........
		........
		........
		........
	`,colors:["#212529","#f8f9fa","#ced4da","#228be6","#fa5252","#fcc419","#ff922b","#40c057","#f06595","#a52f01"],messageBackground:0,messageColor:1,dialogBackground:0,dialogColor:1,dialogBorder:1,screenWidth:8,screenHeight:8,cellWidth:8,cellHeight:8,background:1,volume:.5,controls:{LEFT:["KeyA","ArrowLeft"],RIGHT:["KeyD","ArrowRight"],UP:["KeyW","ArrowUp"],DOWN:["KeyS","ArrowDown"],ACTION:["Enter","Space"]}};var E=r=>r.trim().replace(/[ \t]/gm,"").split(/\n+/gm),T0=r=>{let x=r.length;return [Math.max(...r.map(t=>t.length)),x]};var Q=r=>{try{return new URL(r),!0}catch{return  false}},v0="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".split(""),m=(r,x)=>{if(r=`${r}`,r.length>1)return r;if(!v0.includes(r))return "transparent";let e=v0.findIndex(i=>i===r);return x[e]??"transparent"};var P0=(r,x)=>{let e;return (...t)=>{let i;return e&&clearTimeout(e),e=setTimeout(()=>{i=r(...t);},x),i}};function g(){let r=0,x=new Map;return {subscribe(e){let t=r++;return x.set(t,e),()=>x.delete(t)},notify(e){x.forEach(t=>t(e));},clear(){x.clear();}}}var L="odyc-dialog-canvas";var I="odyc-filter-canvas";var F="odyc-message-canvas";var N="odyc-prompt-canvas";var G="odyc-renderer-canvas";var K0=[[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[24,60,60,24,24,0,24,0],[54,54,0,0,0,0,0,0],[54,54,127,54,127,54,54,0],[12,62,3,30,48,31,12,0],[0,99,51,24,12,102,99,0],[28,54,28,110,59,51,110,0],[6,6,3,0,0,0,0,0],[24,12,6,6,6,12,24,0],[6,12,24,24,24,12,6,0],[0,102,60,255,60,102,0,0],[0,12,12,63,12,12,0,0],[0,0,0,0,0,12,12,6],[0,0,0,63,0,0,0,0],[0,0,0,0,0,12,12,0],[96,48,24,12,6,3,1,0],[62,99,115,123,111,103,62,0],[12,14,12,12,12,12,63,0],[30,51,48,28,6,51,63,0],[30,51,48,28,48,51,30,0],[56,60,54,51,127,48,120,0],[63,3,31,48,48,51,30,0],[28,6,3,31,51,51,30,0],[63,51,48,24,12,12,12,0],[30,51,51,30,51,51,30,0],[30,51,51,62,48,24,14,0],[0,12,12,0,0,12,12,0],[0,12,12,0,0,12,12,6],[24,12,6,3,6,12,24,0],[0,0,63,0,0,63,0,0],[6,12,24,48,24,12,6,0],[30,51,48,24,12,0,12,0],[62,99,123,123,123,3,30,0],[12,30,51,51,63,51,51,0],[63,102,102,62,102,102,63,0],[60,102,3,3,3,102,60,0],[31,54,102,102,102,54,31,0],[127,70,22,30,22,70,127,0],[127,70,22,30,22,6,15,0],[60,102,3,3,115,102,124,0],[51,51,51,63,51,51,51,0],[30,12,12,12,12,12,30,0],[120,48,48,48,51,51,30,0],[103,102,54,30,54,102,103,0],[15,6,6,6,70,102,127,0],[99,119,127,127,107,99,99,0],[99,103,111,123,115,99,99,0],[28,54,99,99,99,54,28,0],[63,102,102,62,6,6,15,0],[30,51,51,51,59,30,56,0],[63,102,102,62,54,102,103,0],[30,51,7,14,56,51,30,0],[63,45,12,12,12,12,30,0],[51,51,51,51,51,51,63,0],[51,51,51,51,51,30,12,0],[99,99,99,107,127,119,99,0],[99,99,54,28,28,54,99,0],[51,51,51,30,12,12,30,0],[127,99,49,24,76,102,127,0],[30,6,6,6,6,6,30,0],[3,6,12,24,48,96,64,0],[30,24,24,24,24,24,30,0],[8,28,54,99,0,0,0,0],[0,0,0,0,0,0,0,255],[12,12,24,0,0,0,0,0],[0,0,30,48,62,51,110,0],[7,6,6,62,102,102,59,0],[0,0,30,51,3,51,30,0],[56,48,48,62,51,51,110,0],[0,0,30,51,63,3,30,0],[28,54,6,15,6,6,15,0],[0,0,110,51,51,62,48,31],[7,6,54,110,102,102,103,0],[12,0,14,12,12,12,30,0],[48,0,48,48,48,51,51,30],[7,6,102,54,30,54,103,0],[14,12,12,12,12,12,30,0],[0,0,51,127,127,107,99,0],[0,0,31,51,51,51,51,0],[0,0,30,51,51,51,30,0],[0,0,59,102,102,62,6,15],[0,0,110,51,51,62,48,120],[0,0,59,110,102,6,15,0],[0,0,62,3,30,48,31,0],[8,12,62,12,12,44,24,0],[0,0,51,51,51,51,110,0],[0,0,51,51,51,30,12,0],[0,0,99,107,127,127,54,0],[0,0,99,54,28,54,99,0],[0,0,51,51,51,62,48,31],[0,0,63,25,12,38,63,0],[56,12,12,7,12,12,56,0],[24,24,24,0,24,24,24,0],[7,12,12,56,12,12,7,0],[110,59,0,0,0,0,0,0],[0,0,0,0,0,0,0,0]],$0=[[0,0,0,0,0,0,0,0],[24,24,0,24,24,24,24,0],[24,24,126,3,3,126,24,24],[28,54,38,15,6,103,63,0],[0,0,99,62,54,62,99,0],[51,51,30,63,12,63,12,12],[24,24,24,0,24,24,24,0],[124,198,28,54,54,28,51,30],[51,0,0,0,0,0,0,0],[60,66,153,133,133,153,66,60],[60,54,54,124,0,0,0,0],[0,204,102,51,102,204,0,0],[0,0,0,63,48,48,0,0],[0,0,0,0,0,0,0,0],[60,66,157,165,157,165,66,60],[126,0,0,0,0,0,0,0],[28,54,54,28,0,0,0,0],[24,24,126,24,24,0,126,0],[28,48,24,12,60,0,0,0],[28,48,24,48,28,0,0,0],[24,12,0,0,0,0,0,0],[0,0,102,102,102,62,6,3],[254,219,219,222,216,216,216,0],[0,0,0,24,24,0,0,0],[0,0,0,0,0,24,48,30],[8,12,8,28,0,0,0,0],[28,54,54,28,0,0,0,0],[0,51,102,204,102,51,0,0],[195,99,51,189,236,246,243,3],[195,99,51,123,204,102,51,240],[3,196,99,180,219,172,230,128],[12,0,12,6,3,51,30,0],[7,0,28,54,99,127,99,0],[112,0,28,54,99,127,99,0],[28,54,0,62,99,127,99,0],[110,59,0,62,99,127,99,0],[99,28,54,99,127,99,99,0],[12,12,0,30,51,63,51,0],[124,54,51,127,51,51,115,0],[30,51,3,51,30,24,48,30],[7,0,63,6,30,6,63,0],[56,0,63,6,30,6,63,0],[12,18,63,6,30,6,63,0],[54,0,63,6,30,6,63,0],[7,0,30,12,12,12,30,0],[56,0,30,12,12,12,30,0],[12,18,0,30,12,12,30,0],[51,0,30,12,12,12,30,0],[63,102,111,111,102,102,63,0],[63,0,51,55,63,59,51,0],[14,0,24,60,102,60,24,0],[112,0,24,60,102,60,24,0],[60,102,24,60,102,60,24,0],[110,59,0,62,99,99,62,0],[195,24,60,102,102,60,24,0],[0,54,28,8,28,54,0,0],[92,54,115,123,111,54,29,0],[14,0,102,102,102,102,60,0],[112,0,102,102,102,102,60,0],[60,102,0,102,102,102,60,0],[51,0,51,51,51,51,30,0],[112,0,102,102,60,24,24,0],[15,6,62,102,102,62,6,15],[0,30,51,31,51,31,3,3],[7,0,30,48,62,51,126,0],[56,0,30,48,62,51,126,0],[126,195,60,96,124,102,252,0],[110,59,30,48,62,51,126,0],[51,0,30,48,62,51,126,0],[12,12,30,48,62,51,126,0],[0,0,254,48,254,51,254,0],[0,0,30,3,3,30,48,28],[7,0,30,51,63,3,30,0],[56,0,30,51,63,3,30,0],[126,195,60,102,126,6,60,0],[51,0,30,51,63,3,30,0],[7,0,14,12,12,12,30,0],[28,0,14,12,12,12,30,0],[62,99,28,24,24,24,60,0],[51,0,14,12,12,12,30,0],[27,14,27,48,62,51,30,0],[0,31,0,31,51,51,51,0],[0,7,0,30,51,51,30,0],[0,56,0,30,51,51,30,0],[30,51,0,30,51,51,30,0],[110,59,0,30,51,51,30,0],[0,51,0,30,51,51,30,0],[24,24,0,126,0,24,24,0],[0,96,60,118,126,110,60,6],[0,7,0,51,51,51,126,0],[0,56,0,51,51,51,126,0],[30,51,0,51,51,51,126,0],[0,51,0,51,51,51,126,0],[0,56,0,51,51,62,48,31],[0,0,6,62,102,62,6,0],[0,51,0,51,51,62,48,31]],Z0=[[45,0,12,12,12,44,24,0],[12,30,51,51,63,51,51,0],[63,102,102,62,102,102,63,0],[63,51,3,3,3,3,3,0],[8,28,28,54,54,99,127,0],[127,70,22,30,22,70,127,0],[127,99,49,24,76,102,127,0],[51,51,51,63,51,51,51,0],[28,54,99,127,99,54,28,0],[30,12,12,12,12,12,30,0],[103,102,54,30,54,102,103,0],[8,28,28,54,54,99,99,0],[99,119,127,127,107,99,99,0],[99,103,111,123,115,99,99,0],[127,99,0,62,0,99,127,0],[28,54,99,99,99,54,28,0],[127,54,54,54,54,54,54,0],[63,102,102,62,6,6,15,0],[0,1,2,4,79,144,160,64],[127,99,6,12,6,99,127,0],[63,45,12,12,12,12,30,0],[51,51,51,30,12,12,30,0],[24,126,219,219,219,126,24,0],[99,99,54,28,54,99,99,0],[219,219,219,126,24,24,60,0],[62,99,99,99,54,54,119,0],[51,0,30,12,12,12,30,0],[51,0,51,51,30,12,30,0],[112,0,110,59,19,59,110,0],[56,0,30,3,14,3,30,0],[56,0,31,51,51,51,51,48],[56,0,12,12,12,44,24,0],[45,0,51,51,51,51,30,0],[0,0,110,59,19,59,110,0],[0,30,51,31,51,31,3,3],[0,0,51,51,30,12,12,0],[56,12,24,62,51,51,30,0],[0,0,30,3,14,3,30,0],[0,63,6,3,3,30,48,28],[0,0,31,51,51,51,51,48],[0,0,30,51,63,51,30,0],[0,0,12,12,12,44,24,0],[0,0,51,27,15,27,51,0],[0,3,6,12,28,54,99,0],[0,0,102,102,102,62,6,3],[0,0,51,51,51,30,12,0],[30,3,14,3,3,30,48,28],[0,0,30,51,51,51,30,0],[0,0,127,54,54,54,54,0],[0,0,60,102,102,54,6,6],[0,0,62,3,3,30,48,28],[0,0,126,27,27,27,14,0],[0,0,126,24,24,88,48,0],[0,0,51,51,51,51,30,0],[0,0,118,219,219,126,24,0],[0,99,54,28,28,54,99,0],[0,0,219,219,219,126,24,0],[0,0,54,99,107,127,54,0]],Q0=[[0,0,0,0,0,0,0,0],[4,63,4,60,86,77,38,0],[4,63,4,60,86,77,38,0],[0,0,0,17,33,37,2,0],[0,1,17,33,33,37,2,0],[0,28,0,28,34,32,24,0],[60,0,60,66,64,32,24,0],[28,0,62,16,56,36,98,0],[28,0,62,16,56,36,98,0],[36,79,4,60,70,69,34,0],[36,79,4,60,70,69,34,0],[4,36,79,84,82,18,9,0],[68,36,15,84,82,82,9,0],[8,31,8,63,28,2,60,0],[68,47,4,31,14,1,30,0],[16,8,4,2,4,8,16,0],[40,68,18,33,2,4,8,0],[0,34,121,33,33,34,16,0],[64,34,17,61,17,18,8,0],[0,0,60,0,2,2,60,0],[32,64,22,32,1,1,14,0],[16,126,16,60,2,2,28,0],[36,79,20,46,1,1,14,0],[0,2,2,2,66,34,28,0],[32,66,18,34,2,34,28,0],[16,126,24,20,24,16,12,0],[68,47,6,5,6,4,3,0],[32,114,47,34,26,2,28,0],[128,80,58,23,26,2,28,0],[30,8,4,127,8,4,56,0],[79,36,2,127,8,4,56,0],[2,15,2,114,2,9,113,0],[66,47,2,114,2,9,113,0],[8,126,8,60,64,64,56,0],[68,47,4,30,32,32,28,0],[0,0,0,28,34,32,28,0],[0,28,34,65,64,32,28,0],[64,32,30,33,32,32,28,0],[0,62,8,4,4,4,56,0],[0,62,72,36,4,4,56,0],[4,4,8,60,2,2,60,0],[68,36,8,60,2,2,60,0],[50,2,39,34,114,41,17,0],[0,2,122,2,10,114,2,0],[8,9,62,75,101,85,34,0],[4,7,52,76,102,84,36,0],[0,0,60,74,73,69,34,0],[0,34,122,34,114,42,18,0],[128,81,29,17,57,21,9,0],[64,177,93,17,57,21,9,0],[0,0,19,50,81,17,14,0],[64,32,3,50,81,17,14,0],[64,160,67,50,81,17,14,0],[28,0,8,42,73,16,12,0],[76,32,8,42,73,16,12,0],[76,160,72,10,41,72,12,0],[0,0,4,10,17,32,64,0],[32,64,20,42,17,32,64,0],[32,80,36,10,17,32,64,0],[125,17,125,17,57,85,9,0],[157,81,29,17,57,85,9,0],[93,177,93,17,57,85,9,0],[126,8,62,8,28,42,4,0],[0,7,36,36,126,37,18,0],[4,15,100,6,5,38,60,0],[0,9,61,74,75,69,42,0],[2,15,2,15,98,66,60,0],[0,0,18,31,34,18,4,0],[0,18,63,66,66,52,4,0],[0,0,17,61,83,57,17,0],[0,17,61,83,81,57,17,0],[0,8,56,8,28,42,4,0],[8,8,56,8,28,42,4,0],[30,0,2,58,70,66,48,0],[0,32,34,34,42,36,16,0],[31,8,60,66,73,84,56,0],[4,7,4,12,22,85,36,0],[63,16,8,60,66,65,48,0],[0,0,8,14,56,76,42,0],[4,7,4,60,70,69,36,0],[14,8,60,74,105,85,50,0],[6,60,66,57,4,54,73,0],[4,15,4,110,17,8,112,0],[8,8,4,12,86,82,33,0],[64,46,0,60,66,64,56,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[64,128,32,64,0,0,0,0],[64,160,64,0,0,0,0,0],[0,0,8,8,16,48,12,0],[32,64,20,36,8,24,6,0],[0,0,0,0,0,0,0,0]],J0=[[255,255,255,255,0,0,0,0],[0,0,0,0,0,0,0,255],[0,0,0,0,0,0,255,255],[0,0,0,0,0,255,255,255],[0,0,0,0,255,255,255,255],[0,0,0,255,255,255,255,255],[0,0,255,255,255,255,255,255],[0,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255],[127,127,127,127,127,127,127,127],[63,63,63,63,63,63,63,63],[31,31,31,31,31,31,31,31],[15,15,15,15,15,15,15,15],[7,7,7,7,7,7,7,7],[3,3,3,3,3,3,3,3],[1,1,1,1,1,1,1,1],[240,240,240,240,240,240,240,240],[85,0,170,0,85,0,170,0],[85,170,85,170,85,170,85,170],[255,170,255,85,255,170,255,85],[255,0,0,0,0,0,0,0],[128,128,128,128,128,128,128,128],[0,0,0,0,15,15,15,15],[0,0,0,0,240,240,240,240],[15,15,15,15,0,0,0,0],[15,15,15,15,255,255,255,255],[15,15,15,15,240,240,240,240],[255,255,255,255,15,15,15,15],[255,255,255,255,240,240,240,240],[240,240,240,240,0,0,0,0],[240,240,240,240,15,15,15,15],[240,240,240,240,255,255,255,255]],xx=[[0,4,8,127,3,63,3,127],[0,54,0,127,3,63,3,127],[0,31,6,62,102,102,102,54],[0,16,8,127,3,3,3,3],[0,62,99,3,15,3,99,62],[0,62,99,3,62,96,99,62],[0,126,24,24,24,24,24,126],[0,54,0,127,28,28,28,127],[0,120,96,96,96,99,99,62],[0,30,27,27,59,91,91,59],[0,27,27,27,63,91,91,59],[0,31,6,62,102,102,102,102],[0,16,8,99,51,31,51,99],[0,4,8,99,115,123,111,103],[0,20,8,99,54,60,24,15],[0,99,99,99,99,127,28,28],[0,28,54,99,99,127,99,99],[0,63,3,3,63,99,99,63],[0,63,99,99,63,99,99,63],[0,127,3,3,3,3,3,3],[0,62,54,54,54,54,127,99],[0,127,3,3,63,3,3,127],[0,107,107,62,28,62,107,107],[0,62,99,96,56,96,99,62],[0,99,115,123,107,111,103,99],[0,20,8,99,115,123,111,103],[0,99,51,27,15,27,51,99],[0,124,102,102,102,102,102,99],[0,99,119,127,107,99,99,99],[0,99,99,99,127,99,99,99],[0,62,99,99,99,99,99,62],[0,127,99,99,99,99,99,99],[0,63,99,99,63,3,3,3],[0,62,99,3,3,3,99,62],[0,126,24,24,24,24,24,24],[0,99,99,54,60,24,12,7],[0,8,62,107,107,107,62,8],[0,99,119,62,28,62,119,99],[0,51,51,51,51,51,127,96],[0,99,99,99,127,96,96,96],[0,107,107,107,107,107,107,127],[0,107,107,107,107,107,127,96],[0,7,6,62,102,102,102,62],[0,99,99,99,103,107,107,103],[0,3,3,3,63,99,99,63],[0,62,99,96,120,96,99,62],[0,57,109,109,111,109,109,57],[0,126,99,99,126,108,102,99],[0,0,0,62,96,126,99,126],[0,62,3,63,99,99,99,62],[0,0,0,63,99,63,99,63],[0,0,0,127,3,3,3,3],[0,0,0,62,54,54,127,99],[0,0,0,62,99,127,3,62],[0,0,0,107,107,62,107,107],[0,0,0,62,99,56,99,62],[0,0,0,99,115,123,111,103],[0,20,8,0,115,123,111,103],[0,0,0,99,51,31,51,99],[0,0,0,124,102,102,102,99],[0,0,0,99,119,127,107,99],[0,0,0,99,99,127,99,99],[0,0,0,62,99,99,99,62],[0,0,0,127,99,99,99,99],[0,0,0,63,99,63,3,3],[0,0,0,62,99,3,99,62],[0,0,0,126,24,24,24,24],[0,0,0,99,54,60,24,15],[0,0,8,62,107,107,62,8],[0,0,0,119,62,28,62,119],[0,0,0,51,51,51,127,96],[0,0,0,99,99,127,96,96],[0,0,0,107,107,107,107,127],[0,0,0,107,107,107,127,96],[0,0,0,7,6,62,102,62],[0,0,0,99,99,103,107,103],[0,0,0,3,3,63,99,63],[0,0,0,62,99,120,99,62],[0,0,0,57,109,111,109,57],[0,0,0,126,99,126,108,102],[0,4,8,62,99,127,3,62],[0,54,0,62,99,127,3,62],[0,15,6,62,102,102,102,48],[0,16,8,0,127,3,3,3],[0,0,0,62,99,15,99,62],[0,0,0,126,3,127,96,63],[0,24,0,30,24,24,24,127],[0,54,0,30,24,24,24,127],[0,96,0,96,96,96,99,62],[0,0,0,30,27,59,91,59],[0,0,0,27,27,63,91,59],[0,6,15,6,62,102,102,102],[0,16,8,0,99,51,31,115],[0,4,8,0,115,123,111,103],[0,20,8,0,54,60,24,15],[0,0,0,99,99,99,127,28],[0,54,65,65,93,73,62,20],[0,0,0,107,107,107,62,54],[0,4,31,4,60,100,100,60],[0,4,4,31,4,60,100,60],[0,51,91,27,63,27,91,51],[0,0,0,115,27,63,27,115],[0,8,28,54,99,127,107,107],[0,0,0,28,54,99,127,107],[0,17,57,109,69,127,85,85],[0,0,0,57,109,69,127,85],[0,127,99,54,8,62,107,107],[0,0,0,62,20,8,62,107],[0,125,69,41,17,63,85,85],[0,0,0,125,41,17,63,85],[0,99,115,51,51,51,30,12],[0,0,0,99,51,51,30,12],[0,99,115,51,51,51,30,12],[54,108,0,99,51,51,30,12],[0,62,99,3,3,30,24,24],[0,0,0,62,99,3,30,24],[0,64,104,48,90,12,22,2],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,6,15,6,62,102,102,62],[0,6,6,15,6,62,102,62],[0,63,99,107,63,19,3,3],[0,0,0,63,107,63,19,3],[0,64,127,3,3,3,3,3],[0,0,64,127,3,3,3,3],[0,126,6,6,31,6,6,6],[0,0,0,126,6,31,6,6],[0,63,3,63,99,99,96,63],[0,0,0,63,3,63,96,63],[0,107,62,28,62,107,107,64],[0,0,107,107,62,107,107,64],[0,62,99,56,99,62,8,12],[0,62,96,56,96,62,8,12],[0,115,27,15,27,51,99,64],[0,0,99,51,31,51,99,64],[0,97,53,29,15,29,53,97],[0,0,0,97,53,31,53,97],[0,98,55,26,14,26,50,98],[0,2,7,98,50,30,50,98],[0,103,54,30,14,30,54,102],[0,0,0,103,54,30,54,102],[0,51,51,63,51,51,115,64],[0,0,51,51,63,51,115,64],[0,115,51,51,63,51,51,51],[0,0,0,115,51,63,51,51],[0,15,9,57,73,73,73,32],[0,0,0,15,57,73,73,32],[0,38,81,81,81,81,33,94],[0,0,0,38,81,81,33,94],[0,62,99,3,99,62,8,12],[0,0,62,3,3,62,8,12],[0,126,24,24,24,24,56,32],[0,0,0,126,24,24,56,32],[0,102,102,102,60,24,24,24],[0,0,0,102,102,60,24,24],[0,99,99,99,54,28,127,28],[0,0,0,99,54,28,127,28],[0,119,62,28,62,119,99,64],[0,0,119,62,28,62,119,64],[0,47,34,34,34,34,126,64],[0,0,0,47,34,34,126,64],[0,51,51,63,48,48,112,64],[0,0,0,51,63,48,112,64],[0,99,107,107,127,104,104,96],[0,0,0,99,107,127,104,96],[0,3,3,63,99,99,99,99],[0,0,3,3,63,99,99,99],[0,56,108,109,127,12,76,56],[0,0,0,56,109,127,12,56],[0,56,108,109,127,12,56,16],[0,0,56,109,127,12,56,16],[0,126,24,24,24,24,24,126],[0,20,28,107,107,62,107,107],[0,20,28,0,107,62,107,107],[0,99,99,127,96,96,112,16],[0,0,0,99,127,96,112,16],[0,28,26,24,24,24,24,126],[0,20,28,28,54,99,127,99],[0,20,28,62,96,126,99,126],[0,54,0,28,54,99,127,99],[0,54,0,62,96,126,99,126],[0,124,30,27,123,31,27,123],[0,0,0,63,108,127,13,63],[0,20,28,127,3,31,3,127],[0,20,28,62,99,127,3,62],[0,30,51,96,127,99,54,28],[0,0,0,63,96,127,99,62],[0,30,51,96,127,99,54,28],[0,108,0,63,96,127,99,62],[0,54,0,107,107,62,107,107],[0,0,54,0,107,62,107,107],[0,62,99,96,56,96,99,62],[0,108,0,62,99,56,99,62],[0,63,48,24,56,99,99,62],[0,0,0,63,16,56,99,62],[0,62,0,99,115,123,111,103],[0,0,62,0,115,123,111,103],[0,54,0,99,115,123,111,103],[0,0,54,0,115,123,111,103],[0,54,0,62,99,99,99,62],[0,0,54,0,62,99,99,62],[0,62,99,99,127,99,99,62],[0,0,0,62,99,127,99,62],[0,62,99,99,127,99,99,62],[0,108,0,62,99,127,99,62],[0,62,99,96,120,96,99,62],[0,108,0,62,99,120,99,62],[0,62,0,99,54,60,24,15],[0,0,62,0,99,54,28,15],[0,54,0,99,54,60,24,15],[0,0,54,0,99,54,28,15],[0,20,20,99,54,60,24,15],[0,20,20,0,54,60,24,15],[0,54,0,99,99,127,96,96],[0,0,54,0,99,127,96,96],[0,127,3,3,3,3,7,4],[0,0,0,127,3,3,7,4],[0,99,99,99,103,107,107,103],[0,108,0,99,99,103,107,103]],U=[{start:0,characters:K0},{start:160,characters:$0},{start:912,characters:Z0},{start:12352,characters:Q0},{start:9600,characters:J0},{start:1024,characters:xx}];var E0={"~":"waveY",_:"waveX","%":"shake","=":"shakeX","^":"shakeY","\xB0":"blink"},y=class r{#e;#t;#r;#x;#i;constructor(x,e,t){this.#r=x,this.#x=e,this.#i=t,this.#e=[{pattern:"\\\\.",type:"char",process:i=>i.charAt(1)},{pattern:this.#c(x),type:"char"},{pattern:"<.>",type:"color",process:i=>i.charAt(1)},{pattern:Object.keys(E0).map(this.#c).join("|"),type:"effect",process:i=>E0[i]},{pattern:"[^\\n\\r\\t]",type:"char"}],this.#t=new RegExp(this.#e.map(i=>`(${i.pattern})`).join("|"),"g");}parseText(x,e){let t=this.#n(x),i=this.#s(t);return this.#a(i,e)}draw(x,e,t,i,n){for(let s=0;s<e.length;s++){let a=e[s];if(a===void 0)continue;let o=t+s*8,c=i,l=a.color?m(a.color,this.#i):null;switch(l?x.fillStyle=l:x.fillStyle=this.#x,a.effect){case "waveY":c+=Math.floor(Math.sin(n*.01+s)*3);break;case "waveX":o+=Math.floor(Math.sin(n*.01+s)*2);break;case "shake":o+=Math.floor((Math.random()-.5)*2),c+=Math.floor((Math.random()-.5)*2);break;case "shakeX":o+=Math.floor((Math.random()-.5)*2);break;case "shakeY":c+=Math.floor((Math.random()-.5)*2);break;case "blink":Math.sin(n*.015)>0&&(x.fillStyle="transparent");break}r.#o(x,a.value,o,c);}}#n(x){let e=x.matchAll(this.#t),t=[];for(let i of e){i.shift();let n=i.findIndex(c=>c!==void 0),{type:s,process:a}=this.#e[n],o=a?a(i[n]):i[n];t.push({value:o,type:s});}return t}#s(x){let e=[],t=[],i=[];for(let n=0;n<x.length;n++){let s=x[n];if(!s)continue;let{type:a,value:o}=s;if(a==="char"){let c=t[t.length-1],l=i[i.length-1];e.push({value:o,color:c,effect:l});continue}if(s.type==="color"){let c=t.lastIndexOf(o);c!==-1?t.splice(c,1):t.push(o);continue}if(s.type==="effect"){let c=i.lastIndexOf(o);c!==-1?i.splice(c,1):i.push(o);}}return e}#a(x,e){let t=[];x:for(;x.length>0;){let i=x.findIndex((n,s)=>n.value===this.#r&&s<e);if(i!==-1){t.push(x.splice(0,i)),x.splice(0,1);continue}else if(x.length<=e){t.push(x),x=[];continue}for(let n=e;n>=0;n--)if(x[n]?.value===" "){t.push(x.splice(0,n)),x.splice(0,1);continue x}t.push(x.splice(0,e));}return x.length>0&&t.push(x),t}#c(x){return x.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}static#o(x,e,t,i){let n=e.charCodeAt(0),s=this.#f(n);if(s)for(let a=0;a<8;a++){let o=s[a];if(o!==void 0)for(let c=0;c<8;c++)o&1<<c&&x.fillRect(t+c,i+a,1,1);}}static text(x,e,t,i){for(let n=0;n<e.length;n++){let s=e.charAt(n);r.#o(x,s,t+n*8,i);}}static#f(x){let e=U.find(t=>x>=t.start&&x<t.start+t.characters.length);return e?e.characters[x-e.start]:null}};function S(r){let x=new Map;return (t,...i)=>{let n=x.get(t);if(n)return n;let s=r(...i);return x.set(t,s),s}}var k=class r{x;y;constructor(x,e){this.x=x,this.y=e;}#e(...x){let[e]=x;return e instanceof r?e:b(...x)}get value(){return [this.x,this.y]}set value(x){this.x=x[0],this.y=x[1];}get length(){return Math.sqrt(this.x*this.x+this.y*this.y)}get direction(){return new r(Math.sign(this.x),Math.sign(this.y))}add(...x){let e=this.#e(...x);return new r(this.x+e.x,this.y+e.y)}sub(...x){let e=this.#e(...x);return new r(this.x-e.x,this.y-e.y)}multiply(x){return new r(this.x*x,this.y*x)}divide(x){return new r(this.x/x,this.y/x)}distance(...x){return this.#e(...x).sub(this).length}equals(...x){let e=this.#e(...x);return e.x===this.x&&e.y===this.y}};function b(...r){let[x,e]=r;return typeof x=="number"?new k(x,e):new k(...x)}var A=class{canvas;#e;constructor(){if(this.canvas=document.createElement("canvas"),this.#e=this.canvas.getContext("2d"),!this.#e)throw new Error("Failed to get 2D context for screenshot canvas");this.update();}update(){let x=document.querySelector(`canvas.${G}`),e=document.querySelector(`canvas.${L}`),t=document.querySelector(`canvas.${N}`),i=document.querySelector(`canvas.${F}`),n=document.querySelector(`canvas.${I}`),s=[];x&&s.push(x),e&&s.push(e),t&&s.push(t),i&&s.push(i),n&&s.push(n);let a=0;s.forEach(l=>{a=Math.max(a,l.width,l.height);});let o=[];if(n&&n.style.display!=="none"){let l=this.#t(n);o.push(l);}else x&&o.push(x);if(e&&e.style.display!=="none"&&o.push(e),t&&t.style.display!=="none"&&o.push(t),i&&i.style.display!=="none"&&o.push(i),o.length===0)throw new Error("No visible canvas frames found for screenshot");this.canvas.width=a,this.canvas.height=a;let c=getComputedStyle(document.body).backgroundColor||"black";this.#e.fillStyle=c,this.#e.fillRect(0,0,a,a),this.#e.imageSmoothingEnabled=false,o.forEach(l=>{let f=Math.min(a/l.width,a/l.height),u=l.width*f,h=l.height*f,P=(a-u)/2,K=(a-h)/2;this.#e.drawImage(l,P,K,u,h);});}save(x){let e=this.canvas.toDataURL("image/png"),t=document.createElement("a");t.href=e,t.download=`${x}.png`,document.body.appendChild(t),t.click(),document.body.removeChild(t);}get dataUrl(){return this.canvas.toDataURL("image/png")}#t(x){let e=x.getContext("webgl",{preserveDrawingBuffer:true}),t=x.width,i=x.height,n=new Uint8Array(t*i*4);e?.readPixels(0,0,t,i,e.RGBA,e.UNSIGNED_BYTE,n);let s=t*4,a=new Uint8Array(s);for(let f=0;f<i/2;f++){let u=f*s,h=(i-f-1)*s;a.set(n.subarray(u,u+s)),n.copyWithin(u,h,h+s),n.set(a,h);}let o=new ImageData(new Uint8ClampedArray(n),t,i),c=document.createElement("canvas");return c.width=t,c.height=i,c.getContext("2d")?.putImageData(o,0,0),c}};var J=class{element;constructor({id:x,zIndex:e}){this.element=document.createElement("canvas"),this.element.style.setProperty("position","absolute"),this.element.style.setProperty("image-rendering","pixelated"),x&&this.element.classList.add(x),e&&this.element.style.setProperty("z-index",e.toString()),document.body.append(this.element),window.addEventListener("resize",this.#e);}show(){this.element.style.setProperty("display","block");}hide(){this.element.style.setProperty("display","none");}setSize(x,e){this.element.width=x,this.element.height=e,this.#e();}get2dCtx(){let x=this.element.getContext("2d");if(!x)throw new Error("failled to access context of the canvas");return x}getWebglCtx(){let x=this.element.getContext("webgl",{preserveDrawingBuffer:true});if(!x)throw new Error("failled to access context of the canvas");return x}#e=()=>{let x=this.element.width<this.element.height?"vertical":"horizontal",e=Math.min(window.innerWidth,window.innerHeight),t=x==="horizontal"?e:e/this.element.height*this.element.width,i=x==="vertical"?e:e/this.element.width*this.element.height,n=(window.innerWidth-t)*.5,s=(window.innerHeight-i)*.5;this.element.style.setProperty("width",`${t}px`),this.element.style.setProperty("height",`${i}px`),this.element.style.setProperty("left",`${n}px`),this.element.style.setProperty("top",`${s}px`);}},ex=S(r=>new J(r)),d=r=>ex(r.id,r);var x0=class{#e;#t;#r;#x;#i;#n=[];#s=0;#a;#c=0;#o;isOpen=false;#f;#h;#p;#u;#m;#l;#g;#d;constructor(x){this.#f=m(x.dialogBackground,x.colors),this.#h=m(x.dialogColor,x.colors),this.#p=m(x.dialogBorder,x.colors),this.#u=x.dialogInternvalMs,this.#e=d({id:L,zIndex:10}),this.#e.setSize(384,384),this.#e.hide(),this.#t=this.#e.get2dCtx(),this.#l=28*8+8*2,this.#m=2*8+12*2+10*1,this.#g=(384-this.#l)*.5,this.#d=384-this.#m-Math.floor(384/15),this.#o=new y("|",this.#h,x.colors);}async open(x){if(!(x.length<=0))return this.isOpen=true,this.#e.show(),this.#x=this.#o.parseText(x,28),this.#i=this.#x.shift(),this.#n=new Array(2).fill(null).map(e=>[]),this.#a=requestAnimationFrame(this.#b),new Promise(e=>{this.#r=()=>e();})}next(){this.#i&&this.#i.length>0||this.#s<1||(this.#i=this.#x?.shift(),this.#s=0,this.#n=this.#n.map(()=>[]),this.#i===void 0&&this.close());}#b=x=>{if(this.#a=requestAnimationFrame(this.#b),x-this.#c<(this.#u||30))return;this.#c=x,this.#i?.length===0&&this.#s<1&&(this.#s++,this.#i=this.#x?.shift());let e=this.#i?.shift();e&&this.#n[this.#s]?.push(e),this.#y(x);};close(){this.isOpen=false,this.#e.hide(),this.#s=0,this.#r?.(),this.#a&&cancelAnimationFrame(this.#a);}#y=x=>{this.#v();let e=this.#g+8;for(let t=0;t<this.#n.length;t++){let i=this.#n[t];if(!i)continue;let n=this.#d+12+8*t+t*10;this.#o.draw(this.#t,i,e,n,x);}};#v(){this.#t.clearRect(0,0,384,384),this.#t.fillStyle=this.#p,this.#t.fillRect(this.#g-2,this.#d-2,this.#l+2*2,this.#m+2*2),this.#t.fillStyle=this.#f,this.#t.fillRect(this.#g,this.#d,this.#l,this.#m);}},I0=r=>new x0(r);var w0=({gameState:r,messageBox:x,camera:e})=>{let t=false;return {play:async(...i)=>{i.length&&x.open(i),t=true,e.reset(),r.turn.reset(),r.player.restoreSavedState(),r.actors.initActors();},get ending(){return t},set ending(i){t=i;}}};var e0=`attribute vec2 a_position;
varying vec2 v_texCoords;
void main() {
    gl_Position = vec4(a_position, 0.0, 1.0);
    v_texCoords = a_position * vec2(0.5, -0.5) + 0.5;
}
`;var t0=`precision mediump float;
varying vec2 v_texCoords;
uniform sampler2D u_texture;

void main() {
    gl_FragColor = texture2D(u_texture, v_texCoords);
}
`;var R0=`precision mediump float;
varying vec2 v_texCoords;
uniform sampler2D u_texture;
uniform vec2 u_size;
uniform float u_sideCount;
uniform float u_scale;
uniform float u_rotation;

#define PI 3.14159265359
#define TWO_PI 6.28318530718
#define CELL_SIZE 24.

void main() {
    float d = 0.0;
    vec2 uv = fract(v_texCoords * (u_size / CELL_SIZE));
    vec2 st = uv * 2. - 1.;

    float a = atan(st.x, st.y) + PI + u_rotation * TWO_PI;
    float r = TWO_PI / float(u_sideCount);

    d = cos(floor(.5 + a / r) * r - a) * length(st);

    float threshold = 1.0 - step(u_scale, d);
    gl_FragColor = texture2D(u_texture, v_texCoords) * threshold;
}
`;var M0=`precision mediump float;
varying vec2 v_texCoords;

uniform sampler2D u_texture;
uniform vec2 u_size;

uniform float u_warp;
uniform float u_lineWidth;
uniform float u_lineIntensity;
uniform float u_lineCount;

void main() {
    vec2 fragCoord = v_texCoords * u_size;
    vec2 uv = v_texCoords;

    vec2 dc = abs(0.5 - uv);
    dc *= dc;

    uv.x -= 0.5;
    uv.x *= 1.0 + dc.y * (0.3 * u_warp);
    uv.x += 0.5;

    uv.y -= 0.5;
    uv.y *= 1.0 + dc.x * (0.4 * u_warp);
    uv.y += 0.5;

    if (uv.x < 0.0 || uv.x > 1.0 || uv.y < 0.0 || uv.y > 1.0) {
        gl_FragColor = vec4(0.0);
    } else {
        float dist = abs(fract(uv.y * u_lineCount) - 0.5);
        float scanLine = min(step(u_lineWidth * .5, dist) + (1. - u_lineIntensity), 1.);

        vec3 color = texture2D(u_texture, uv).rgb;
        gl_FragColor = vec4(color * scanLine, 1.0);
    }
}
`;var D0=`precision mediump float;

varying vec2 v_texCoords;
uniform sampler2D u_texture;
uniform vec2 u_size;

uniform float u_scale;
uniform float u_intensity;

#define PI 3.14159265359
#define TWO_PI 6.28318530718
#define CELL_SIZE 24.

float mosaic(float scale) {
    float d = 0.0;
    vec2 uv = fract(v_texCoords * (u_size / CELL_SIZE));
    vec2 st = uv * 2. - 1.;

    float a = atan(st.x, st.y) + PI;
    float r = TWO_PI / 4.;

    d = cos(floor(.5 + a / r) * r - a) * length(st);

    return 1.0 - step(scale, d);
}

vec3 blur() {
    vec2 radius = CELL_SIZE / u_size;
    vec3 blur = vec3(0);
    float count = 0.;

    for (int j = 0; j < 16; j++) {
        float d = float(j) * TWO_PI / 16.;
        vec2 offset = vec2(cos(d), sin(d)) / (u_size / CELL_SIZE);
        blur += texture2D(u_texture, v_texCoords + offset).rgb;
        count++;
    }

    return blur / count;
}

void main() {
    vec3 color = texture2D(u_texture, v_texCoords).rgb;

    vec3 with_blur = mix(color, blur(), u_intensity);
    gl_FragColor = vec4(max(color, with_blur), 1.) * mosaic(u_scale);
}
`;var r0={fractal:{fragment:R0,settings:{sideCount:12,scale:.9,rotation:0}},crt:{fragment:M0,settings:{warp:.7,lineIntensity:.2,lineWidth:.6,lineCount:85}},neon:{fragment:D0,settings:{scale:.75,intensity:.8}}},O0=r=>{if("name"in r){let x=Object.assign({},r0[r.name].settings,r.settings);return {vertex:r0[r.name].vertex??e0,fragment:r0[r.name].fragment??t0,settings:x}}return {vertex:r.vertex??e0,fragment:r.fragment??t0,settings:r.settings}};var i0=class{canvas;#e;#t={};#r;#x;#i;#n;#s;#a=new Map;#c;constructor(x,e){if(this.#e=O0(e),this.#e.settings)for(let s in this.#e.settings){let a=this.#e.settings?.[s];this.#t[s]=Array.isArray(a)?[...a]:a;}this.#r=x,this.canvas=d({id:I});let t=this.canvas.getWebglCtx();if(!t)throw new Error("WebGL not supported");this.#x=t;let i=this.#o(this.#x.VERTEX_SHADER,this.#e.vertex),n=this.#o(this.#x.FRAGMENT_SHADER,this.#e.fragment);this.#i=this.#f(i,n),this.#x.useProgram(this.#i),this.#c=this.#x.getAttribLocation(this.#i,"a_position"),this.#s=this.#h(),this.#n=this.#p(),this.#r.style.setProperty("display","none");}render(){this.canvas.show(),this.canvas.setSize(this.#r.width,this.#r.height),this.#l("size",[this.canvas.element.width,this.canvas.element.height]),this.#t&&Object.entries(this.#t).forEach(([x,e])=>{this.#l(x,e);}),this.#x.viewport(0,0,this.canvas.element.width,this.canvas.element.height),this.#x.clearColor(0,0,0,1),this.#x.clear(this.#x.COLOR_BUFFER_BIT),this.#u(),this.#x.bindBuffer(this.#x.ARRAY_BUFFER,this.#s),this.#x.enableVertexAttribArray(this.#c),this.#x.vertexAttribPointer(this.#c,2,this.#x.FLOAT,false,0,0),this.#x.drawArrays(this.#x.TRIANGLES,0,6);}setUniforms(x){for(let[e,t]of Object.entries(x))this.#t[e]=Array.isArray(t)?[...t]:t;}#o(x,e){let t=this.#x.createShader(x);if(this.#x.shaderSource(t,e),this.#x.compileShader(t),!this.#x.getShaderParameter(t,this.#x.COMPILE_STATUS)){let i=this.#x.getShaderInfoLog(t);throw this.#x.deleteShader(t),new Error(`Shader compilation failed:
${i}`)}return t}#f(x,e){let t=this.#x.createProgram();if(this.#x.attachShader(t,x),this.#x.attachShader(t,e),this.#x.linkProgram(t),!this.#x.getProgramParameter(t,this.#x.LINK_STATUS)){let i=this.#x.getProgramInfoLog(t);throw this.#x.deleteProgram(t),new Error(`Program link failed:
${i}`)}if(this.#x.validateProgram(t),!this.#x.getProgramParameter(t,this.#x.VALIDATE_STATUS))throw new Error("validating program"+this.#x.getProgramInfoLog(t));return t}#h(){let x=new Float32Array([1,1,-1,1,-1,-1,-1,-1,1,-1,1,1]),e=this.#x.createBuffer();if(this.#x.bindBuffer(this.#x.ARRAY_BUFFER,e),this.#x.bufferData(this.#x.ARRAY_BUFFER,x,this.#x.STATIC_DRAW),this.#x.bindBuffer(this.#x.ARRAY_BUFFER,null),!e)throw new Error("failed to create quad");return e}#p(){let x=this.#x.createTexture();if(this.#x.bindTexture(this.#x.TEXTURE_2D,x),this.#x.texParameteri(this.#x.TEXTURE_2D,this.#x.TEXTURE_WRAP_S,this.#x.CLAMP_TO_EDGE),this.#x.texParameteri(this.#x.TEXTURE_2D,this.#x.TEXTURE_WRAP_T,this.#x.CLAMP_TO_EDGE),this.#x.texParameteri(this.#x.TEXTURE_2D,this.#x.TEXTURE_MIN_FILTER,this.#x.NEAREST),this.#x.texParameteri(this.#x.TEXTURE_2D,this.#x.TEXTURE_MAG_FILTER,this.#x.NEAREST),this.#x.texImage2D(this.#x.TEXTURE_2D,0,this.#x.RGBA,this.#x.RGBA,this.#x.UNSIGNED_BYTE,this.#r),this.#x.bindTexture(this.#x.TEXTURE_2D,null),!x)throw new Error("failed to create texture");return x}#u(){this.#x.bindTexture(this.#x.TEXTURE_2D,this.#n),this.#x.texImage2D(this.#x.TEXTURE_2D,0,this.#x.RGBA,this.#x.RGBA,this.#x.UNSIGNED_BYTE,this.#r);}#m(x){let e=`u_${x}`;if(this.#a.has(e))return this.#a.get(e);let t=this.#x.getUniformLocation(this.#i,e);return t&&this.#a.set(e,t),t}#l(x,e){let t=this.#m(x);if(t){if(typeof e=="number"&&(e=[e]),e.length<1||e.length>4)throw new Error("setUniform supports 1\u20134 float values");switch(e.length){case 1:this.#x.uniform1f(t,e[0]);break;case 2:this.#x.uniform2f(t,e[0],e[1]);break;case 3:this.#x.uniform3f(t,e[0],e[1],e[2]);break;case 4:this.#x.uniform4f(t,e[0],e[1],e[2],e[3]);break}}}},L0=(r,x)=>x?new i0(r,x):(d({id:I}).hide(),null);var F0=(r,x,e,t,i,n,s)=>{let a={player:r.player.facade,getCell:(o,c)=>r.actors.getCell(o,c),addToCell:(o,c,l)=>r.actors.addToCell(o,c,l),setCell:(o,c,l)=>r.actors.setCell(o,c,l),getAll:o=>r.actors.getAll(o),setAll:(o,c)=>r.actors.setAll(o,c),openDialog:o=>x.open(o),prompt:(...o)=>e.open(...o),openMenu:o=>e.openMenu(o),openMessage:(...o)=>n.open(o),playSound:(...o)=>t.play(...o),end:(...o)=>i.play(...o),loadMap:(o,c)=>{c&&(r.player.position=[...c]),r.gameMap.map=o,r.player.saveCurrentState();},updateFilter:o=>{r.filterUniforms.set(o);},get width(){return r.gameMap.dimensions[0]},get height(){return r.gameMap.dimensions[1]},get turn(){return r.turn.value},clear:o=>{O(o);}};return b0(s,x,n,e,a),a};function cx(r,x=0){let e=r.charCodeAt(0),t=U.find(s=>e>=s.start&&e<s.start+s.characters.length);if(!t)return "";let i=t.characters[e-t.start];if(!i)return "";let n="";for(let s=0;s<8;s++){let a=i[s];if(a!==void 0){for(let o=0;o<8;o++)a&1<<o?n+=x:n+=".";n+=`
`;}}return n}function lx(r){new A().save(r);}var N0=1e3/30,n0=class{#e;#t=[];#r;#x=0;#i;#n;constructor(){this.#i=["video/webm","video/webm,codecs=vp9","video/vp8","video/webm;codecs=vp8","video/webm;codecs=daala","video/webm;codecs=h264","video/mpeg"].find(e=>MediaRecorder.isTypeSupported(e))??"",this.#n=new A;let x=this.#n.canvas.captureStream(N0);this.#e=new MediaRecorder(x,{mimeType:this.#i}),this.#e.ondataavailable=e=>{this.#t.push(e.data);};}start(){this.#t=[],this.#e.start(100),this.#r=requestAnimationFrame(this.#s);}stop(){this.#r&&cancelAnimationFrame(this.#r),this.#e.stop();}save(x){let e=new Blob(this.#t,{type:this.#i}),t=URL.createObjectURL(e),i=document.createElement("a");i.style.display="none",i.href=t,i.download=x+".webm",document.body.appendChild(i),i.click(),document.body.removeChild(i);}#s=x=>{x-this.#x>N0&&(this.#n.update(),this.#x=x),this.#r=requestAnimationFrame(this.#s);}};function fx(){let r=new n0;return r.start(),x=>{r.stop(),r.save(x);}}var s0=class{#e;#t;#r;#x;constructor(x){this.#e=x.gameState,this.#t=x.soundPlayer,this.#r=x.dialog,this.#x=x.ender;}async update(x){this.#x.ending=false,this.#e.player.setDirection(x);let e=b(this.#e.player.position),t=e.add(hx[x]);if(this.#a(t.value)){let i=this.#e.actors.getCell(...t.value);i.solid||(await this.#e.actors.getEvent(...e.value,"onLeave")?.(),this.#e.player.position=t.value),this.#i(i),await this.#n(i),i.solid?await this.#e.actors.getEvent(...t.value,"onCollide")?.():await this.#e.actors.getEvent(...t.value,"onEnter")?.();}for(let i of this.#e.actors.get())await this.#e.actors.getEvent(...i.position,"onTurn")?.();this.#e.player.dispatchOnTurn(),this.#x.ending||this.#e.turn.next(),await this.#s(this.#e.actors.getCell(...t.value));}#i(x){let e=x.sound;if(e){let t=Array.isArray(e)?e:[e];this.#t.play(...t);}}async#n(x){x.dialog&&await this.#r.open(x.dialog);}async#s(x){let e=x.end;e&&(typeof e=="string"?await this.#x.play(e):typeof e=="boolean"&&e?this.#x.play():await this.#x.play(...e));}#a([x,e]){return x>=0&&e>=0&&x<this.#e.gameMap.dimensions[0]&&e<this.#e.gameMap.dimensions[1]}},hx={LEFT:[-1,0],RIGHT:[1,0],UP:[0,-1],DOWN:[0,1],ACTION:[0,0]},G0=r=>new s0(r);var R=class{#e;#t;constructor(x,e){this.#e=x,this.#t=e;}get sprite(){return this.#r()?.sprite??null}set sprite(x){this.#x("sprite",x);}get solid(){return this.#r()?.solid??false}set solid(x){this.#x("solid",x);}get sound(){return this.#r()?.sound??null}set sound(x){this.#x("sound",x);}get position(){return this.#r()?.position??[-1,-1]}get dialog(){return this.#r()?.dialog??null}set dialog(x){this.#x("dialog",x);}get visible(){return this.#r()?.visible??false}set visible(x){this.#x("visible",x);}get foreground(){return this.#r()?.foreground??false}set foreground(x){this.#x("foreground",x);}get end(){return this.#r()?.end??null}set end(x){this.#x("end",x);}get symbol(){return this.#r()?.symbol??null}get isOnScreen(){return this.#r()?.isOnScreen??false}remove(){this.#t.clearCell(...this.#e);}#r(){return this.#t.get().find(x=>b(x.position).equals(this.#e))}#x(x,e){this.#t.setCell(...this.#e,{[x]:e});}};var H=class{#e=[];#t;#r;#x;constructor(x,e){this.#t=e,this.#r=x.templates,this.#x=g(),this.initActors(),e.subscribe(()=>this.initActors());}subscribe(x){this.#x.subscribe(x);}getAll(x){return this.#e.filter(e=>e.symbol===x).map(e=>new R(e.position,this))}setAll(x,e){for(let t=0;t<this.#e.length;t++){let i=this.#e[t];if(i?.symbol!==x)continue;let n=Object.assign({},i,e);this.#e[t]=n;}this.#x.notify();}setCell(x,e,t){for(let i=0;i<this.#e.length;i++){let n=this.#e[i];if(n&&n.position&&b(n.position).equals([x,e])){let s=Object.assign({},n,t);this.#e[i]=s;break}}this.#x.notify();}addToCell(x,e,t){let i=this.#s(this.#r,t);i&&(this.#e=[...this.#e.filter(n=>!b([x,e]).equals(n.position)),this.#n(x,e,t,i)],this.#x.notify());}getCell(x,e){return new R([x,e],this)}clearCell(x,e){this.#e=this.#e.filter(t=>!b(t.position).equals([x,e])),this.#x.notify();}getEvent(x,e,t){let i=this.#e.find(n=>n.position[0]===x&&n.position[1]===e)?.[t];if(i)return ()=>i(this.getCell(x,e))}get(){return this.#e}handleScreenEvents(x){let e=[],t=[];for(let i=0;i<this.#e.length;i++){let n=this.#e[i];if(!n)continue;let s=x.isOnScreen(n.position);n.isOnScreen!==s&&(this.#e[i].isOnScreen=s,s?t.push(this.getEvent(...n.position,"onScreenEnter")):e.push(this.getEvent(...n.position,"onScreenLeave")));}e.forEach(i=>{i&&i();}),t.forEach(i=>{i&&i();});}initActors(){this.#e=this.#i(E(this.#t.map),this.#r);}#i(x,e){let t=[];for(let i=0;i<x.length;i++){let n=x[i];if(n)for(let s=0;s<n.length;s++){let a=n[s];if(!a)continue;let o=this.#s(e,a);o&&t.push(this.#n(s,i,a,o));}}return t}#n(x,e,t,i){return {symbol:t,sprite:i.sprite??null,position:[x,e],dialog:i.dialog??null,isOnScreen:false,end:i.end??null,sound:i.sound??null,solid:i.solid!==false,visible:i.visible!==false,foreground:i.foreground===true,onCollide:i.onCollide,onEnter:i.onEnter,onLeave:i.onLeave,onScreenEnter:i.onScreenEnter,onScreenLeave:i.onScreenLeave,onTurn:i.onTurn}}#s(x,e){let t=x[e];if(t)return typeof t=="function"?t():t}};var V=class{#e;#t;constructor(x){this.#e=this.#r(x),this.#t=g();}subscribe(x){this.#t.subscribe(x);}get(){return this.#r(this.#e)}set(x){for(let[e,t]of Object.entries(x))this.#e[e]=Array.isArray(t)?[...t]:t;this.#t.notify();}#r(x){let e={};for(let t in x){let i=x[t];i!==void 0&&(e[t]=Array.isArray(i)?[...i]:i);}return e}};var B=class{#e;#t;constructor(x){this.#e=x,this.#t=g();}subscribe(x){return this.#t.subscribe(x)}get map(){return this.#e}set map(x){this.#e=x,this.#t.notify(this.#e);}get dimensions(){return T0(E(this.#e))}};var X=class{#e;#t;#r;#x;#i;#n;#s;#a;#c;#o=[0,0];constructor(x){this.#e=x.sprite??null,this.#t=x.position??[0,0],this.#r=x.visible??true,this.#x=x.sprite??null,this.#i=x.position??[0,0],this.#n=x.visible??true,this.#s=x.onTurn,this.#a=x.onInput,this.#c=g();}subscribe(x){return this.#c.subscribe(x)}saveCurrentState(){this.#e=this.#x,this.#t=[...this.#i],this.#r=this.visible;}restoreSavedState(){this.#x=this.#e,this.#i=[...this.#t],this.#n=this.#r,this.#c.notify();}dispatchOnTurn(){this.#s?.(this.facade);}dispatchOnInput(x){this.#a?.(x);}get visible(){return this.#n}set visible(x){this.#n=x,this.#c.notify();}get sprite(){return this.#x}get position(){return this.#i}set sprite(x){this.#x=x,this.#c.notify();}set position(x){this.#i=[...x],this.#c.notify();}get direction(){return this.#o}setDirection(x){switch(x){case "LEFT":this.#o=[-1,0];break;case "UP":this.#o=[0,-1];break;case "RIGHT":this.#o=[1,0];break;case "DOWN":this.#o=[0,1];break}}get facade(){let x=this;return {get sprite(){return x.sprite},set sprite(e){x.sprite=e;},get position(){return x.position},set position(e){x.position=e;},get direction(){return x.direction},get visible(){return x.visible},set visible(e){x.visible=e;}}}};var q=class{#e=0;constructor(){}next(){this.#e++;}get value(){return this.#e}reset(){this.#e=0;}};var U0=r=>{let x=new B(r.map),e=new V(r.filter?.settings??{}),t=new X(r.player),i=new H(r,x),n=new q,s=g();return e.subscribe(()=>{s.notify();}),t.subscribe(()=>{s.notify();}),i.subscribe(()=>{s.notify();}),{player:t,actors:i,gameMap:x,filterUniforms:e,turn:n,subscribe:s.subscribe}};var o0=class{controls=[];lastKeysEvents=new Map;onInput;lastPointerEvent=0;oldTouchX;oldTouchY;pointerId;isSliding=false;static get touchEventElement(){}constructor(){let x=document.createElement("div");x.classList.add("odyc-touchEvent"),x.style.setProperty("position","absolute"),x.style.setProperty("left","0"),x.style.setProperty("height","0"),x.style.setProperty("width","100vw"),x.style.setProperty("height","100vh"),x.style.setProperty("overflow","hidden"),x.style.setProperty("touch-action","none"),x.style.setProperty("z-index","999999999"),document.body.appendChild(x),document.body.style.setProperty("margin","0"),document.addEventListener("keydown",this.handleKeydown),x.addEventListener("pointerdown",this.handleTouch),x.addEventListener("pointerup",this.handleTouchUp),x.addEventListener("pointerleave",this.handleTouchLeave),x.addEventListener("pointercancel",this.handleTouchLeave),x.addEventListener("pointermove",this.handleTouchMove);}init(x,e){this.lastKeysEvents.clear(),this.lastPointerEvent=0,this.oldTouchX=void 0,this.oldTouchY=void 0,this.pointerId=void 0,this.isSliding=false,this.controls=Object.entries(x.controls),this.onInput=e;}handleTouch=x=>{x.pointerType!=="mouse"&&(this.pointerId=x.pointerId,this.oldTouchX=x.clientX,this.oldTouchY=x.clientY);};handleTouchUp=x=>{this.pointerId===x.pointerId&&(this.pointerId=void 0,this.isSliding||this.onInput?.("ACTION"),this.isSliding=false);};handleTouchLeave=x=>{this.pointerId===x.pointerId&&(this.pointerId=void 0,this.isSliding=false);};handleTouchMove=x=>{if(this.pointerId!==x.pointerId)return;let e=x.clientX,t=x.clientY;if(e===void 0||t===void 0||this.oldTouchX===void 0||this.oldTouchY===void 0)return;let i=e-this.oldTouchX,n=t-this.oldTouchY,s=x.timeStamp;if(!(Math.abs(i)<30&&Math.abs(n)<30)&&!(s-this.lastPointerEvent<200))if(this.lastPointerEvent=s,this.oldTouchX=e,this.oldTouchY=t,this.isSliding=true,Math.abs(n)>Math.abs(i)){let a=Math.sign(n);this.onInput?.(a<0?"UP":"DOWN");}else {let a=Math.sign(i);this.onInput?.(a<0?"LEFT":"RIGHT");}};handleKeydown=x=>{let e=this.controls.find(([s,a])=>a===x.code||a.includes(x.code));if(!e)return;let[t]=e,i=x.timeStamp,n=this.lastKeysEvents.get(x.code);x.repeat&&n&&i-n<200||(this.lastKeysEvents.set(x.code,i),this.onInput?.(t));}},px=S(()=>new o0),W0=(r,x)=>{let e=px(null);return e.init(r,x),e};var a0=class{#e;#t;isOpen=false;#r;#x=[];#i=[];#n;#s;#a=0;#c;#o;#f=0;#h;#p;#u;#m;#l=192;#g=1;#d=2;constructor(x){this.#p=x.colors,this.#u=m(x.messageBackground,x.colors),this.#m=m(x.messageColor,x.colors),this.#n=Math.floor((this.#l-2*this.#g)/8),this.#s=Math.floor(this.#l/(8+this.#d)),this.#c=x.messageInternvalMs,this.#e=d({id:F,zIndex:10}),this.#e.hide(),this.#t=this.#e.get2dCtx(),this.#e.setSize(this.#l,this.#l),this.#h=new y(`
`,this.#m,this.#p);}open(x){let e=typeof x=="string"?[x]:[...x];if(e.length===0||e[0]?.length===0)return;this.isOpen=true,this.#x=e;let t=this.#x[this.#a];if(t)return this.#i=this.#h.parseText(t,this.#n),this.#e.show(),this.#o=requestAnimationFrame(this.#b),new Promise(i=>this.#r=()=>i())}next(){this.#a++;let x=this.#x[this.#a];x?(this.#i=this.#h.parseText(x,this.#n),this.#o=requestAnimationFrame(this.#b)):this.close();}#b=x=>{this.#o=requestAnimationFrame(this.#b),!(x-this.#f<(this.#c||30))&&this.#y(x);};#y(x){this.#t.clearRect(0,0,this.#l,this.#l),this.#t.fillStyle=this.#u,this.#t.fillRect(0,0,this.#l,this.#l),this.#t.fillStyle=this.#m;let e=Math.min(this.#i.length,this.#s),t=e*8+(e-1)*this.#d,i=(this.#l-t)*.5;for(let n=0;n<e;n++){let s=this.#i[n];if(!s)continue;let a=s.length*8,o=(this.#l-a)*.5,c=i+n*8+n*this.#d;this.#h.draw(this.#t,s,o,c,x);}}close=()=>{this.#a=0,this.#i=[],this.isOpen=false,this.#o&&cancelAnimationFrame(this.#o),this.#e.hide(),this.#r?.();}},H0=r=>new a0(r);var f0=class{#e;#t;#r;isOpen=false;#x=[];#i=0;#n;#s;#a;#c;constructor(x){this.#n=x.colors,this.#s=this.#u(x.dialogBackground),this.#a=this.#u(x.dialogColor),this.#c=this.#u(x.dialogBorder),this.#e=d({id:N,zIndex:10}),this.#e.setSize(384,384),this.#e.hide(),this.#t=this.#e.get2dCtx();}get#o(){let x=28*8+8*2,e=(384-x)*.5,t=Math.floor(384/15),i=Math.max(Math.ceil(this.#x.length/2),2),n=i*8+12*2+10*(i-1);return {left:e,top:t,width:x,height:n}}async openMenu(x){let e=Object.keys(x),t=e[await this.open(...e)];if(!t||!(t in x))return;let i=x[t];if(i)return typeof i=="function"?i():await this.openMenu(i)}async open(...x){return x.length?(this.#i=0,this.isOpen=true,this.#e.show(),this.#x=x,this.#f(),new Promise(e=>{this.#r=t=>e(t);})):-1}input(x){let e=Math.ceil(this.#x.length/2),t=Math.floor(this.#i/2),i=this.#i-t*2;switch(x){case "LEFT":i=Math.max(0,i-1);break;case "UP":t=Math.max(0,t-1);break;case "RIGHT":i=Math.min(i+1,1);break;case "DOWN":t=Math.min(t+1,e-1);break;case "ACTION":this.close();return}this.#i=Math.min(t*2+i,this.#x.length-1),this.#f();}close(){this.isOpen=false,this.#e.hide(),this.#r?.(this.#i);}#f(){this.#p();let{left:x,top:e,width:t}=this.#o;this.#t.fillStyle=this.#a;let i=Math.ceil(28/2-2);for(let n=0;n<this.#x.length;n++){let s=this.#x[n]?.slice(0,i);if(!s)continue;let a=Math.floor(n/2),o=n-a*2,c=x+8+o*(t-8*2)/2+(o+1)*8,l=e+12+8*a+a*10;y.text(this.#t,s,c,l);}this.#h();}#h(){let x=Math.floor(this.#i/2),e=this.#i-x*2,{left:t,top:i,width:n}=this.#o,s=t+8+e*(n-8*2)/2+e*8,a=i+12+8*x+x*10;for(let o=0;o<8/2;o++)this.#t.fillRect(s+o,a+o,1,8-2*o);}#p(){this.#t.clearRect(0,0,384,384),this.#t.fillStyle=this.#c;let{left:x,top:e,height:t,width:i}=this.#o;this.#t.fillRect(x-2,e-2,i+2*2,t+2*2),this.#t.fillStyle=this.#s,this.#t.fillRect(x,e,i,t);}#u(x){return typeof x=="string"?x:this.#n[x]??"black"}},B0=r=>new f0(r);var h0=class{canvas;#e=24;screenWidth;screenHeight;cellWidth;cellHeight;colors;ctx;background;constructor(x){this.screenWidth=x.screenWidth,this.screenHeight=x.screenHeight,this.cellWidth=x.cellWidth,this.cellHeight=x.cellHeight,this.colors=x.colors,this.background=x.background,this.canvas=d({id:G}),this.canvas.show(),this.ctx=this.canvas.get2dCtx();}render(x,e,t){this.clear();let i=false;for(let n of e)n.foreground&&n.position[0]===x.position[0]&&n.position[1]===x.position[1]?(x.visible&&this.#t(x,t),this.#t(n,t),i=true):this.#t(n,t);i||this.#t(x,t);}clear(x){this.canvas.setSize(this.cellWidth*this.screenWidth*this.#e,this.cellHeight*this.screenHeight*this.#e);let e=x??this.background;e!==void 0&&(typeof this.background=="number"?this.ctx.fillStyle=this.colors[this.background]??this.colors[0]??"black":this.ctx.fillStyle=m(e,this.colors),this.ctx.fillRect(0,0,this.screenWidth*this.cellWidth*this.#e,this.screenHeight*this.cellHeight*this.#e));}#t(x,e){if(x.sprite===void 0||x.sprite===null||x.visible===false||!e.isOnScreen(x.position))return;let[t,i]=x.position,[n,s]=e.position,a=(t-n)*this.cellWidth,o=(i-s)*this.cellHeight;if(a+this.cellWidth<0||o+this.cellHeight<0||a>this.screenWidth*this.cellWidth||o>this.screenHeight*this.cellHeight)return;let c=x.sprite;if(typeof c=="number"||c.length===1){let f=m(c,this.colors);if(!f)return;this.ctx.fillStyle=f,this.ctx.fillRect(Math.floor(a)*this.#e,Math.floor(o)*this.#e,this.cellWidth*this.#e,this.cellHeight*this.#e);return}let l=E(c);for(let f=0;f<this.cellHeight;f++)for(let u=0;u<this.cellWidth;u++){let h=l[f]?.charAt(u);if(!h)continue;let P=m(h,this.colors);P&&(this.ctx.fillStyle=P,this.ctx.fillRect(Math.floor(a+u)*this.#e,Math.floor(o+f)*this.#e,this.#e,this.#e));}}},X0=r=>new h0(r);var q0={waveForm:[{name:"waveForm",defaultValue:0,type:"radio",options:[{value:0,label:"Sine"},{value:1,label:"SawTooth"},{value:2,label:"Square"},{value:3,label:"Triangle"}]}],volume:[{name:"volume",min:0,max:1,step:.01,type:"range",defaultValue:.5}],soundEnveloppe:[{name:"attackTime",min:0,max:2,step:.01,type:"range",defaultValue:0},{name:"sustainTime",min:0,max:2,step:.01,type:"range",defaultValue:.07},{name:"sustainPunch",min:0,max:1,step:.01,type:"range",defaultValue:0},{name:"decayTime",min:0,max:2,step:.01,type:"range",defaultValue:.3}],pitch:[{name:"frequency",min:0,max:4e3,step:1,type:"range",defaultValue:700},{name:"pitchDelta",min:-4e3,max:4e3,step:1,type:"range",defaultValue:0},{name:"pitchDuration",min:0,max:1,step:.01,type:"range",defaultValue:1},{name:"pitchDelay",min:0,max:1,step:.01,type:"range",defaultValue:0}],vibrato:[{name:"vibratoRate",min:0,max:70,step:1,type:"range",defaultValue:0},{name:"vibratoDepth",min:0,max:100,step:1,type:"range",defaultValue:0}],tremolo:[{name:"tremoloRate",min:0,max:70,step:1,type:"range",defaultValue:0},{name:"tremoloDepth",min:0,max:1,step:.01,type:"range",defaultValue:0}],filters:[{name:"highPassCutoff",min:0,max:4e3,step:.1,type:"range",defaultValue:0},{name:"highPassResonance",min:0,max:30,step:.1,type:"range",defaultValue:0},{name:"lowPassCutoff",min:0,max:4e3,step:.1,type:"range",defaultValue:4e3},{name:"lowPassResonance",min:0,max:30,step:.1,type:"range",defaultValue:0}],phaser:[{name:"phaserBaseFrequency",min:0,max:1e3,step:1,type:"range",defaultValue:100},{name:"phaserLfoFrequency",min:0,max:200,step:1,type:"range",defaultValue:50},{name:"phaserDepth",min:0,max:1e3,step:1,type:"range",defaultValue:0}],noise:[{name:"noiseAmount",min:0,max:500,step:1,type:"range",defaultValue:0}]},_=Object.values(q0).flatMap(r=>[...r]),j=_.reduce((r,x)=>({...r,[x.name]:x.defaultValue}),{}),gx=(r,{noiseAmount:x})=>{let e=r.createWaveShaper(),t=44100,i=new Float32Array(t),n=Math.PI/180;for(let s=0;s<t;s++){let a=s*2/t-1;i[s]=(3+Math.random()*x)*a*20*n/(Math.PI+Math.random()*x*Math.abs(a));}return e.curve=i,e.oversample="4x",{input:e,output:e}},bx=(r,{attackTime:x,sustainTime:e,sustainPunch:t,decayTime:i})=>{let n=r.createGain(),s=r.currentTime;return n.gain.setValueAtTime(0,s),n.gain.linearRampToValueAtTime(1-t,s+x),n.gain.setValueAtTime(1,s+x),n.gain.linearRampToValueAtTime(1-t,s+x+e),n.gain.linearRampToValueAtTime(0,s+x+e+i),{input:n,output:n}},yx=(r,{highPassCutoff:x,highPassResonance:e})=>{let t=r.createBiquadFilter();return t.type="highpass",t.frequency.value=x,t.Q.value=e,{input:t,output:t}},vx=(r,{lowPassCutoff:x,lowPassResonance:e})=>{let t=r.createBiquadFilter();return t.type="lowpass",t.frequency.value=x,t.Q.value=e,{input:t,output:t}},Tx=(r,x,e)=>Math.min(Math.max(r,x),e),Px=(r,x)=>Math.round(r*10**x)/10**x,Ex=["sine","sawtooth","square","triangle"],Sx=q0.pitch[0].max,Ax=(r,x,{waveForm:e,frequency:t,pitchDelta:i,pitchDuration:n,pitchDelay:s})=>{let a=x*s,o=(x-a)*n,c=r.createOscillator();return c.type=Ex[e]??"sine",c.frequency.setValueAtTime(t,r.currentTime),c.frequency.linearRampToValueAtTime(t,r.currentTime+a),c.frequency.linearRampToValueAtTime(Tx(0,t+i,Sx),r.currentTime+a+o),{input:c,output:c,start:()=>c.start(),stop:l=>c.stop(l)}},Cx=(r,{phaserBaseFrequency:x,phaserLfoFrequency:e,phaserDepth:t})=>{let i=r.createBiquadFilter();i.type="allpass",i.frequency.value=x;let n=r.createOscillator();n.type="sine",n.frequency.value=e;let s=r.createGain();return s.gain.value=t,n.connect(s),s.connect(i.frequency),{input:i,output:i,start:()=>n.start(),stop:a=>n?.stop(a)}},Y0=(r,x,e)=>{let t=r.createOscillator(),i=r.createGain();return t.frequency.value=e,i.gain.value=x,t.connect(i),{input:t,output:i,start:()=>t.start(),stop:n=>t.stop(n)}},_x=(r,{tremoloDepth:x,tremoloRate:e})=>Y0(r,x,e),Ix=(r,{vibratoDepth:x,vibratoRate:e})=>Y0(r,x,e),wx=(r,{volume:x})=>{let e=r.createGain();return e.gain.value=x,{input:e,output:e}},z0=(r,x,e)=>{let t=Object.assign({},j,r),i=t.attackTime+t.sustainTime+t.decayTime,n=Ax(x,i,t),s=gx(x,t),a=bx(x,t),o=Ix(x,t),c=_x(x,t),l=vx(x,t),f=yx(x,t),u=Cx(x,t),h=wx(x,t);o.output.connect(n.input.frequency),c.output.connect(a.input),n.output.connect(s.input),s.output.connect(u.input),u.output.connect(l.input),l.output.connect(f.input),f.output.connect(a.input),a.output.connect(h.input),h.output.connect(e);let P=[o,c,n,u,l,a];return new Promise(K=>{P.forEach(d0=>{d0.start?.(),d0.stop?.(x.currentTime+i);}),n.output.onended=()=>K();})},u0=r=>{let x={...j},e=r.searchParams.get("fx");if(!e)return x;let t=decodeURI(e).split(",");for(let i=0;i<_.length;i++){let n=_[i]?.name,s=t[i];n&&s&&!isNaN(Number(s))&&(x[n]=Number(s));}return x};var Rx=class{seed;#e;#t;#r;#x;constructor(r){this.seed=r??Date.now(),this.#e=this.seed&4294967295,this.#t=362436069,this.#r=521288629,this.#x=88675123;for(let x=0;x<32;x++)this.#i();}#i(){let r=this.#e^this.#e<<11&4294967295;return this.#e=this.#t,this.#t=this.#r,this.#r=this.#x,this.#x=this.#x^this.#x>>>19^(r^r>>>8),this.#x+2147483648}number(r,x){return r===void 0?(r=0,x=1):x===void 0&&(x=r,r=0),r+(x-r)*this.#i()/4294967295}boolean(r=.5){return this.number(0,1)<r}fromArray(r){return r[Math.floor(this.number(0,r.length))]}},Mx=r=>(_.forEach(x=>{let e=r[x.name];if(x.type==="range"&&e){let t=x.step.toString().split(".")[1]?.length??0;r[x.name]=Px(e,t);}}),Object.assign({},j,r)),m0=(r,x)=>Mx(r(new Rx(x))),D={DEFAULT:()=>({}),PICKUP:r=>({...r.boolean()?{pitchDelta:r.number(100,500),pitchDuration:0,pitchDelay:r.number(0,.7)}:{},waveForm:r.fromArray([0,1,2,3]),sustainPunch:r.number(0,.8),sustainTime:r.number(.05,.2),decayTime:r.number(.1,.3),frequency:r.number(900,1700)}),LASER:r=>{let x=r.number(100,1300);return {waveForm:r.fromArray([0,1,2,3]),sustainPunch:r.number(0,.8),sustainTime:r.number(.05,.1),decayTime:r.number(0,.2),frequency:x,pitchDelta:r.number(-x,-100),pitchDuration:1,pitchDelay:r.fromArray([0,r.number(0,.3)])}},JUMP:r=>({waveForm:r.fromArray([1,2]),sustainPunch:r.number(0,.8),sustainTime:r.number(.2,.5),decayTime:r.number(.1,.2),frequency:r.number(100,500),pitchDelta:r.number(200,500),pitchDuration:1,pitchDelay:r.fromArray([0,r.number(0,.3)])}),FALL:r=>{let x=r.number(80,500);return {waveForm:r.fromArray([1,2,3]),sustainPunch:0,sustainTime:r.number(.2,.5),decayTime:r.number(.2,.5),frequency:x,pitchDelta:-x,pitchDuration:1,pitchDelay:r.number(0,.2),vibratoRate:r.number(8,18),vibratoDepth:r.number(10,30),tremoloRate:r.number(5,18),tremoloDepth:r.number(0,1)}},POWERUP:r=>({waveForm:r.fromArray([0,1,2,3]),sustainPunch:r.number(0,1),sustainTime:r.number(.2,.5),decayTime:r.number(.1,.5),frequency:r.number(200,1e3),pitchDelta:r.number(100,300),pitchDuration:1,pitchDelay:r.fromArray([0,r.number(0,.3)]),vibratoRate:r.number(10,18),vibratoDepth:r.number(50,100)}),EXPLOSION:r=>{let x=r.number(200);return {waveForm:r.fromArray([0,1,2,3]),volume:.3,sustainPunch:r.number(0,.3),sustainTime:r.number(.4,1.3),decayTime:r.number(.1,.5),frequency:x,pitchDelta:-x,pitchDuration:1,pitchDelay:r.number(.3),vibratoRate:r.number(0,70),vibratoDepth:r.number(0,100),tremoloRate:r.number(0,70),tremoloDepth:r.number(0,1),phaserDepth:r.number(300,1e3),noiseAmount:r.number(300,500)}},BLIP:r=>({waveForm:r.fromArray([0,1,2,3]),sustainTime:r.number(.02,.1),decayTime:r.number(0,.04),frequency:r.number(600,3e3)}),HIT:r=>{let x=r.number(20,500);return {waveForm:r.fromArray([0,1,2,3]),sustainTime:r.number(.01,.03),sustainPunch:r.number(.5),decayTime:r.number(0,.2),frequency:x,pitchDelta:r.number(-x,-x*.2),noiseAmount:r.number(100)}},FART:r=>{let x=r.number(30,150);return {waveForm:1,volume:.7,sustainPunch:r.number(0,.2),sustainTime:r.number(.1,.5),decayTime:r.number(.3,.5),frequency:x,pitchDelta:-x/2,pitchDuration:1,pitchDelay:.1,vibratoRate:r.number(8,18),vibratoDepth:r.number(10,30),tremoloRate:r.number(35,70),tremoloDepth:r.number(.6,1),lowPassCutoff:x*10,lowPassResonance:10,noiseAmount:r.number(0,30)}},RANDOM:r=>{let x={...j};for(let e=0;e<_.length;e++){let t=_[e];t&&(t.type==="range"?x[t.name]=r.number(t.min,t.max):t.type==="radio"&&(x[t.name]=r.fromArray(t.options.map(i=>i.value))));}return x}};var p0=class{#e;#t;#r=false;constructor(){this.#e=new AudioContext,this.#t=this.#e.createGain(),this.#t.connect(this.#e.destination);}set volume(x){this.#t.gain.value=x;}async play(...x){if(this.#r)return;this.#r=true;let e=this.#x(...x);return z0(e,this.#e,this.#t).then(()=>{this.#r=false;})}#x(...x){let[e,t]=x;return typeof e!="string"?e:Q(e)?u0(new URL(e)):e in D?m0(D[e],t):{}}},Dx=S(()=>new p0),j0=r=>{let x=Dx(null);return x.volume=r.volume,x},Ox=(...r)=>{let[x,e]=r;return Q(x)?u0(new URL(x)):x in D?m0(D[x],e):{}};var Fx=r=>{let x=Object.assign({},y0,r),e=U0(x),t=j0(x),i=g0(x),n=X0(x),s=I0(x),a=B0(x),o=H0(x),c=L0(n.canvas.element,x.filter),l=w0({gameState:e,messageBox:o,camera:i}),f=P0(()=>{c?.setUniforms(e.filterUniforms.get()),i.update(e.player.position,e.gameMap.dimensions),n.render(e.player,e.actors.get(),i),e.actors.handleScreenEvents(i),c?.render();},60),u=G0({gameState:e,soundPlayer:t,dialog:s,ender:l});return W0(x,h=>{a.isOpen?a.input(h):o.isOpen?h==="ACTION"&&o.next():s.isOpen?h==="ACTION"&&s.next():(h!=="ACTION"&&u.update(h),e.player.dispatchOnInput(h));}),e.subscribe(f),O(),x.title&&o.open(x.title),f(),F0(e,s,a,t,l,o,n)};

    exports.charToSprite = cx;
    exports.createGame = Fx;
    exports.createSound = Ox;
    exports.makeScreenshot = lx;
    exports.startRecording = fx;
    exports.vec2 = b;

    return exports;

})({});

    const {createGame, createSound, charToSprite, vec2, makeScreenshot, startRecording} = odyc
//startofthegame
let count = 0;

const game = createGame({
	player: {
		sprite: `
77707077
77777777
77707077
77770777
.7..777.
77777777
.7..777.
...7.7.7
			`,
		position: [1, 6]
	},
	templates: {
		x: {
			sprite: 7
		},
    y: {
      sprite: 3
    },
    s: {
      sprite: 5,
      onCollide(t) {
        if (count >= 3) {
          game.end("You saved the falling sun!");
          count = 0;
        }
      }
    },
    f: {
      sprite: `
      ........
      ........
      ...55..
      ..5555..
      ..5555..
      ...55...
      ........
      ........
      `,
      onCollide(t) {
        t.remove();
        count++;
      }
    }
	},
	map: `
	yyyyyyyy
	yyyssyyy
	yyyssyyy
	.....f..
	....f...
	..f.....
	........
	xxxxxxxx
	`
})

//endofthegame
    
  </script>
</body>
</html>
